<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé±üéÆ ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿµÿßŸÑÿ© ÿßŸÑÿ®ŸÑŸäÿßÿ±ÿØŸà ŸàÿßŸÑÿ®ŸÑÿßŸäÿ≥ÿ™Ÿäÿ¥ŸÜ - ÿ¨ÿßŸÖÿπÿ© ÿßŸÑÿ£ŸÜÿ®ÿßÿ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0d1117;
            color: #c9d1d9;
            overflow-x: hidden;
        }

        /* ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ */
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0d1117;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .splash-content {
            text-align: center;
            background: #161b22;
            padding: 60px;
            border-radius: 15px;
            border-top: 5px solid #d4af37;
        }

        .splash-icon {
            font-size: 70px;
            margin-bottom: 20px;
            color: #1a472a;
        }

        .splash-title {
            font-size: 28px;
            font-weight: bold;
            color: #1a472a;
            margin-bottom: 10px;
        }

        .splash-subtitle {
            font-size: 14px;
            font-style: italic;
            color: #2d5016;
            margin-bottom: 30px;
        }

        .splash-system-title {
            font-size: 22px;
            font-weight: bold;
            color: #d4af37;
            margin-bottom: 10px;
        }

        .splash-system-subtitle {
            font-size: 12px;
            font-style: italic;
            color: #58a6ff;
            margin-bottom: 40px;
        }

        .progress-container {
            width: 400px;
            height: 8px;
            background: #0d1117;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-bar {
            height: 100%;
            background: #d4af37;
            width: 0%;
            transition: width 0.3s ease;
        }

        .splash-version {
            font-size: 9px;
            color: #6e7681;
            margin-top: 15px;
        }

        .splash-developer {
            font-size: 10px;
            font-weight: bold;
            color: #d4af37;
            margin-top: 5px;
        }

        /* ÿ¥ÿßÿ¥ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ */
        #login-screen {
            display: none;
            min-height: 100vh;
            padding: 40px 20px;
        }

        .login-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo-icon {
            font-size: 60px;
            color: #1a472a;
            margin-bottom: 15px;
        }

        .logo-title-ar {
            font-size: 32px;
            font-weight: bold;
            color: #1a472a;
            margin-bottom: 10px;
        }

        .logo-title-en {
            font-size: 18px;
            font-style: italic;
            color: #2d5016;
        }

        .login-card {
            background: #161b22;
            border-radius: 8px;
            max-width: 600px;
            margin: 30px auto;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .card-accent {
            height: 4px;
            background: #1a472a;
        }

        .card-content {
            padding: 40px;
        }

        .card-title {
            font-size: 20px;
            font-weight: bold;
            color: #c9d1d9;
            text-align: center;
            margin-bottom: 10px;
        }

        .card-subtitle {
            font-size: 14px;
            font-style: italic;
            color: #58a6ff;
            text-align: center;
            margin-bottom: 8px;
        }

        .card-location {
            font-size: 16px;
            color: #8b949e;
            text-align: center;
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-label {
            font-size: 12px;
            font-weight: bold;
            color: #c9d1d9;
            margin-bottom: 8px;
            display: block;
        }

        .input-wrapper {
            background: #0d1117;
            border: 2px solid #30363d;
            border-radius: 6px;
            padding: 12px 14px;
            transition: border-color 0.3s;
        }

        .input-wrapper:focus-within {
            border-color: #1a472a;
        }

        .input-field {
            width: 100%;
            background: transparent;
            border: none;
            color: #c9d1d9;
            font-size: 13px;
            outline: none;
        }

        .input-field::placeholder {
            color: #6e7681;
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn-primary {
            background: #1a472a;
            color: #ffffff;
        }

        .btn-primary:hover {
            background: #2d5d3d;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(26, 71, 42, 0.4);
        }

        .footer-info {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
        }

        .footer-copyright {
            font-size: 9px;
            font-weight: bold;
            color: #d4af37;
            margin-bottom: 5px;
        }

        .footer-version {
            font-size: 8px;
            color: #484f58;
        }

        /* ÿßŸÑŸàÿßÿ¨Ÿáÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© */
        #main-interface {
            display: none;
        }

        .header {
            background: #161b22;
            padding: 20px 40px;
            border-bottom: 5px solid #1a472a;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-logo {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .header-logo-icon {
            font-size: 32px;
            color: #1a472a;
        }

        .header-logo-games {
            font-size: 20px;
            color: #d4af37;
            margin-top: 5px;
        }

        .header-text h1 {
            font-size: 20px;
            font-weight: bold;
            color: #1a472a;
            margin-bottom: 5px;
        }

        .header-text h2 {
            font-size: 24px;
            font-weight: bold;
            color: #d4af37;
            margin-bottom: 5px;
        }

        .header-text p {
            font-size: 9px;
            color: #8b949e;
        }

        .header-right {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .user-info {
            background: #0d1117;
            padding: 15px 20px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-details {
            text-align: right;
        }

        .user-name {
            font-size: 12px;
            font-weight: bold;
            color: #c9d1d9;
        }

        .user-role {
            font-size: 9px;
            color: #3fb950;
            margin-top: 3px;
        }

        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .time-display {
            font-size: 11px;
            font-weight: bold;
            color: #58a6ff;
            padding: 8px 15px;
            background: #161b22;
            border-radius: 6px;
        }

        .btn-notification {
            background: #1f6feb;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-notification:hover {
            background: #388bfd;
        }

        .btn-logout {
            background: #da3633;
            color: white;
            padding: 8px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .btn-logout:hover {
            background: #f85149;
        }

        /* ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© */
        .dashboard {
            max-width: 1200px;
            margin: 60px auto;
            padding: 0 40px;
        }

        .dashboard-title {
            font-size: 22px;
            font-weight: bold;
            color: #c9d1d9;
            text-align: center;
            margin-bottom: 50px;
        }

        .dashboard-sections {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .section-card {
            background: linear-gradient(135deg, #2d5016 0%, #1a472a 100%);
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }

        .section-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 32px rgba(45, 80, 22, 0.4);
        }

        .section-card.ps {
            background: linear-gradient(135deg, #1f6feb 0%, #1a5bd8 100%);
        }

        .section-card.ps:hover {
            box-shadow: 0 8px 32px rgba(31, 111, 235, 0.4);
        }

        .section-icon {
            font-size: 50px;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 24px;
            font-weight: bold;
            color: white;
            margin-bottom: 10px;
        }

        .section-description {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 15px;
            margin-top: 40px;
        }

        .action-btn {
            background: #1a472a;
            color: white;
            padding: 18px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .action-btn:hover {
            background: #2d5d3d;
            transform: translateY(-2px);
        }

        .action-btn.purple {
            background: #8957e5;
        }

        .action-btn.purple:hover {
            background: #a475f9;
        }

        /* ŸÑŸàÿ≠ÿ© ÿßŸÑŸÇÿ≥ŸÖ */
        .section-dashboard {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #161b22;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .stat-card-accent {
            height: 5px;
        }

        .stat-card-content {
            padding: 20px;
            text-align: center;
        }

        .stat-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #c9d1d9;
            margin: 10px 0;
        }

        .stat-label {
            font-size: 10px;
            color: #8b949e;
        }

        .stat-badge {
            display: inline-block;
            font-size: 8px;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 4px;
            margin-top: 5px;
        }

        .section-title-main {
            font-size: 22px;
            font-weight: bold;
            color: #c9d1d9;
            text-align: center;
            margin: 30px 0;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .action-button {
            background: #238636;
            color: white;
            padding: 18px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(35, 134, 54, 0.4);
        }

        .action-button.blue {
            background: #1f6feb;
        }

        .action-button.blue:hover {
            box-shadow: 0 4px 12px rgba(31, 111, 235, 0.4);
        }

        .action-button.purple {
            background: #8957e5;
        }

        .action-button.purple:hover {
            box-shadow: 0 4px 12px rgba(137, 87, 229, 0.4);
        }

        .action-button.gold {
            background: #d4af37;
        }

        .action-button.gold:hover {
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.4);
        }

        .action-button.red {
            background: #da3633;
        }

        .action-button.red:hover {
            box-shadow: 0 4px 12px rgba(218, 54, 51, 0.4);
        }

        .action-button.gray {
            background: #6e7681;
        }

        .action-button.gray:hover {
            box-shadow: 0 4px 12px rgba(110, 118, 129, 0.4);
        }

        /* ÿßŸÑŸÜŸàÿßŸÅÿ∞ ÿßŸÑŸÖŸÜÿ®ÿ´ŸÇÿ© */
        .modal, .notifications-modal, .search-modal, .edit-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content, .notifications-container, .search-container, .edit-container {
            background: #161b22;
            max-width: 600px;
            margin: 50px auto;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        .modal-header, .notifications-header, .search-header, .edit-header {
            background: #238636;
            padding: 20px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
        }

        .notifications-header {
            background: #1f6feb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .search-header, .edit-header {
            background: #1a472a;
        }

        .edit-header {
            background: #1f6feb;
        }

        .notifications-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
        }

        .modal-body, .notifications-body, .search-body, .edit-body {
            padding: 30px;
        }

        .notifications-body {
            max-height: 500px;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            font-size: 12px;
            font-weight: bold;
            color: #c9d1d9;
            margin-bottom: 8px;
            display: block;
        }

        .form-input, .form-select, .search-input {
            width: 100%;
            padding: 12px;
            background: #0d1117;
            border: 2px solid #30363d;
            border-radius: 6px;
            color: #c9d1d9;
            font-size: 13px;
            transition: border-color 0.3s;
        }

        .form-input:focus, .search-input:focus {
            outline: none;
            border-color: #238636;
        }

        .form-select {
            cursor: pointer;
        }

        .info-box, .current-info {
            background: #0d1117;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
        }

        .info-box p, .current-info p {
            font-size: 11px;
            color: #58a6ff;
            margin: 5px 0;
        }

        .modal-footer {
            padding: 20px 30px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .btn-modal, .btn-primary-custom, .btn-secondary-custom {
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-save, .btn-primary-custom {
            background: #238636;
            color: white;
        }

        .btn-save:hover, .btn-primary-custom:hover {
            background: #2ea043;
        }

        .btn-cancel, .btn-secondary-custom {
            background: #6e7681;
            color: white;
        }

        .btn-cancel:hover, .btn-secondary-custom:hover {
            background: #8b949e;
        }

        /* ÿ®ÿ∑ÿßŸÇÿßÿ™ ÿßŸÑŸÑÿßÿπÿ®ŸäŸÜ */
        .players-container, .search-results {
            max-height: 600px;
            overflow-y: auto;
            padding: 10px;
        }

        .player-card, .notification-item, .search-result-item {
            background: #161b22;
            border-radius: 8px;
            margin-bottom: 15px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .notification-item, .search-result-item {
            background: #0d1117;
            padding: 15px;
            margin-bottom: 12px;
            border-right: 4px solid #6e7681;
            transition: all 0.3s;
        }

        .notification-item:hover, .search-result-item:hover {
            transform: translateX(-5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .notification-item.success {
            border-right-color: #238636;
        }

        .notification-item.warning {
            border-right-color: #d4af37;
        }

        .notification-item.error {
            border-right-color: #da3633;
        }

        .notification-item.info {
            border-right-color: #1f6feb;
        }

        .search-result-item {
            border-right-color: #8957e5;
        }

        .player-card-stripe {
            height: 5px;
        }

        .player-card-content {
            padding: 20px;
        }

        .player-header, .search-result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .search-result-header {
            margin-bottom: 8px;
        }

        .player-info h3, .search-result-name {
            font-size: 18px;
            font-weight: bold;
            color: #d4af37;
            margin-bottom: 5px;
        }

        .search-result-name {
            font-size: 15px;
        }

        .player-table-badge {
            display: inline-block;
            background: #238636;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            margin-top: 5px;
        }

        .player-notes {
            font-size: 10px;
            color: #8b949e;
            margin-top: 5px;
        }

        .player-actions {
            display: flex;
            gap: 5px;
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-edit {
            background: #1f6feb;
        }

        .btn-edit:hover {
            background: #388bfd;
        }

        .btn-end {
            background: #da3633;
        }

        .btn-end:hover {
            background: #f85149;
        }

        .player-stats {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .player-stat-box {
            background: #0d1117;
            padding: 12px;
            border-radius: 6px;
            flex: 1;
            min-width: 100px;
            text-align: center;
        }

        .player-stat-label {
            font-size: 9px;
            color: #8b949e;
            margin-bottom: 5px;
        }

        .player-stat-value {
            font-size: 14px;
            font-weight: bold;
        }

        .countdown-box {
            background: linear-gradient(135deg, #d4af37 0%, #f0c14b 100%);
            color: #000;
            font-size: 20px;
            font-weight: bold;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            animation: pulse 2s infinite;
        }

        .countdown-expired {
            background: linear-gradient(135deg, #da3633 0%, #f85149 100%);
            color: white;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        .notification-title {
            font-size: 12px;
            font-weight: bold;
            color: #c9d1d9;
            margin-bottom: 5px;
        }

        .notification-message {
            font-size: 10px;
            color: #8b949e;
            margin-bottom: 5px;
        }

        .notification-time, .search-result-details {
            font-size: 8px;
            color: #6e7681;
        }

        .search-result-details {
            font-size: 9px;
        }

        .search-result-cost {
            font-size: 16px;
            font-weight: bold;
            color: #3fb950;
        }

        /* ÿ≠ÿßŸÑÿßÿ™ ŸÅÿßÿ±ÿ∫ÿ© */
        .empty-state, .empty-notifications, .search-no-results {
            text-align: center;
            padding: 60px 20px;
            background: #161b22;
            border-radius: 12px;
            margin: 20px 0;
        }

        .empty-notifications {
            padding: 50px 20px;
            background: transparent;
        }

        .search-no-results {
            padding: 30px;
            background: transparent;
            color: #8b949e;
        }

        .empty-icon, .empty-notifications-icon {
            font-size: 58px;
            color: #30363d;
            margin-bottom: 20px;
        }

        .empty-notifications-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .empty-text, .empty-notifications-text {
            font-size: 17px;
            color: #8b949e;
        }

        .empty-notifications-text {
            font-size: 16px;
        }

        /* Scrollbar */
        .players-container::-webkit-scrollbar,
        .notifications-body::-webkit-scrollbar,
        .search-results::-webkit-scrollbar {
            width: 8px;
        }

        .players-container::-webkit-scrollbar-track,
        .notifications-body::-webkit-scrollbar-track,
        .search-results::-webkit-scrollbar-track {
            background: #0d1117;
        }

        .players-container::-webkit-scrollbar-thumb,
        .notifications-body::-webkit-scrollbar-thumb,
        .search-results::-webkit-scrollbar-thumb {
            background: #30363d;
            border-radius: 4px;
        }

        .players-container::-webkit-scrollbar-thumb:hover,
        .notifications-body::-webkit-scrollbar-thumb:hover,
        .search-results::-webkit-scrollbar-thumb:hover {
            background: #484f58;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 20px;
            }
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .action-buttons, .dashboard-sections {
                grid-template-columns: 1fr;
            }
            .player-stats {
                flex-direction: column;
            }
            .splash-content {
                padding: 40px 30px;
            }
            .progress-container {
                width: 300px;
            }
        }

        .hidden {
            display: none !important;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        .search-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        /* Firebase Toast Styles */
        .firebase-toast-red {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #dc2626, #ef4444);
            color: #fff;
            font-weight: 800;
            padding: 16px 20px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(220, 38, 38, 0.5);
            z-index: 999999;
            min-width: 300px;
            opacity: 0;
            transform: translateX(100px);
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .firebase-toast-red.show {
            opacity: 1;
            transform: translateX(0);
        }

        .firebase-toast-red .toast-title {
            font-size: 16px;
            margin-bottom: 6px;
        }

        .firebase-toast-red .toast-body {
            font-size: 14px;
            opacity: 0.95;
        }
    
        /* Google user bar */
        .top-userbar{
            position:fixed;
            top:10px;
            right:10px;
            display:none;
            align-items:center;
            gap:10px;
            background:#0f2028;
            border:1px solid #333;
            padding:8px 12px;
            border-radius:10px;
            z-index:99999;
        }
        .top-userbar img{
            width:34px;
            height:34px;
            border-radius:50%;
        }
        .top-userbar .name{
            font-weight:700;
            font-size:13px;
            color:#e6edf3;
        }
        .top-userbar .email{
            font-size:11px;
            color:#9aa4ad;
        }
        .top-userbar .btn-logout{
            background:#d32f2f;
            color:#fff;
            border:none;
            border-radius:8px;
            padding:6px 10px;
            cursor:pointer;
            font-weight:700;
        }
    </style>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
<style>
    /* === ROYAL GALAXY THEME OVERRIDES === */
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background:
            radial-gradient(circle at top left, #1e1b4b 0, #020617 40%) fixed,
            radial-gradient(circle at bottom right, #0f172a 0, #020617 55%) fixed;
        color: #e5e7eb;
        overflow-x: hidden;
    }

    #splash-screen {
        background: radial-gradient(circle at top, #1e1b4b 0, #020617 55%);
    }

    .splash-content {
        background: linear-gradient(145deg, rgba(15,23,42,0.98), rgba(17,24,39,0.98));
        border-radius: 26px;
        border-top: none;
        box-shadow:
            0 0 0 1px rgba(251,191,36,0.25),
            0 26px 80px rgba(15,23,42,0.9),
            0 0 120px rgba(129,140,248,0.35);
    }

    .splash-title,
    .logo-title-ar,
    .dashboard-title,
    .section-title-main {
        color: #facc15 !important;
        text-shadow: 0 0 22px rgba(250,204,21,0.6);
    }

    .splash-icon,
    .logo-icon,
    .header-logo-icon,
    .header-logo-games {
        text-shadow: 0 0 24px rgba(250,204,21,0.85);
    }

    .progress-container {
        background: rgba(15,23,42,0.9);
        box-shadow: 0 0 0 1px rgba(31,41,55,0.9);
        border-radius: 999px;
    }

    .progress-bar {
        background: linear-gradient(90deg, #fbbf24, #f97316, #facc15);
        box-shadow: 0 0 18px rgba(250,204,21,0.8);
    }

    .login-card {
        background:
            radial-gradient(circle at top left, rgba(55,65,81,0.5), transparent 55%),
            radial-gradient(circle at bottom right, rgba(129,140,248,0.35), transparent 60%),
            linear-gradient(145deg, #020617, #020617 35%, #020617 100%);
        border-radius: 26px;
        box-shadow:
            0 0 0 1px rgba(148,163,184,0.18),
            0 28px 80px rgba(15,23,42,0.9),
            0 0 120px rgba(129,140,248,0.35);
    }

    .card-accent {
        background: linear-gradient(90deg, #f59e0b, #fbbf24, #f97316);
    }

    .input-wrapper {
        border-radius: 999px;
        background: rgba(15,23,42,0.9);
        border: 1px solid rgba(148,163,184,0.45);
    }

    .input-wrapper:focus-within {
        border-color: #fbbf24;
        box-shadow: 0 0 0 1px rgba(251,191,36,0.3), 0 0 18px rgba(251,191,36,0.2);
    }

    .btn-primary {
        border-radius: 999px;
        background: linear-gradient(135deg, #fbbf24, #f97316);
        color: #020617;
        box-shadow: 0 18px 35px rgba(250,204,21,0.4);
    }
    .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 22px 45px rgba(250,204,21,0.6);
    }

    .header {
        background:
            radial-gradient(circle at top left, rgba(56,189,248,0.12), transparent 55%),
            radial-gradient(circle at top right, rgba(250,204,21,0.16), transparent 55%),
            linear-gradient(135deg, #020617, #020617 42%, #020617 100%);
        border-bottom: 1px solid rgba(251,191,36,0.35);
        box-shadow: 0 18px 40px rgba(15,23,42,0.85);
    }

    .header-logo {
        border-radius: 24px;
        background: radial-gradient(circle at top, rgba(251,191,36,0.08), transparent 60%);
        border: 1px solid rgba(148,163,184,0.5);
        box-shadow: 0 0 32px rgba(129,140,248,0.45);
    }

    .user-info {
        border-radius: 999px;
        background: radial-gradient(circle at top left, rgba(129,140,248,0.28), transparent 55%), rgba(15,23,42,0.92);
        border: 1px solid rgba(129,140,248,0.5);
        box-shadow: 0 16px 35px rgba(30,64,175,0.75);
    }

    .time-display {
        border-radius: 999px;
        background: rgba(15,23,42,0.9);
        border: 1px solid rgba(148,163,184,0.6);
        color: #facc15;
    }

    .btn-notification {
        border-radius: 999px;
        background: linear-gradient(135deg, #a855f7, #7c3aed);
        box-shadow: 0 16px 35px rgba(129,140,248,0.7);
    }

    .btn-logout {
        border-radius: 999px;
        background: linear-gradient(135deg, #ef4444, #b91c1c);
        box-shadow: 0 16px 35px rgba(248,113,113,0.8);
    }

    .dashboard-sections .section-card,
    .section-card.ps {
        border-radius: 32px;
        background:
            radial-gradient(circle at top left, rgba(168,85,247,0.35), transparent 55%),
            radial-gradient(circle at bottom right, rgba(59,130,246,0.28), transparent 55%),
            linear-gradient(145deg, #020617, #020617 55%, #020617 100%);
        box-shadow:
            0 0 0 1px rgba(129,140,248,0.35),
            0 35px 80px rgba(15,23,42,0.9),
            0 0 120px rgba(129,140,248,0.45);
        position: relative;
    }

    .section-card::before {
        content: "";
        position: absolute;
        inset: 1px;
        border-radius: inherit;
        border: 1px solid rgba(251,191,36,0.45);
        opacity: .8;
        pointer-events: none;
    }

    .section-card:hover {
        transform: translateY(-4px) scale(1.01);
        box-shadow:
            0 0 0 1px rgba(251,191,36,0.7),
            0 40px 90px rgba(15,23,42,0.95),
            0 0 140px rgba(250,204,21,0.55);
    }

    .quick-actions .action-btn {
        border-radius: 999px;
        background: rgba(15,23,42,0.85);
        border: 1px solid rgba(148,163,184,0.5);
        box-shadow: 0 16px 35px rgba(15,23,42,0.9);
    }

    .quick-actions .action-btn.purple {
        background: linear-gradient(135deg, #a855f7, #7c3aed);
        border-color: transparent;
    }

    .stat-card {
        border-radius: 24px;
        background: linear-gradient(145deg, rgba(15,23,42,0.98), rgba(17,24,39,0.98));
        box-shadow:
            0 0 0 1px rgba(30,64,175,0.45),
            0 26px 65px rgba(15,23,42,0.9);
    }

    .stat-card-accent {
        background: linear-gradient(90deg, #f97316, #fbbf24);
    }

    .action-buttons .action-button {
        border-radius: 18px;
        background: rgba(15,23,42,0.96);
        border: 1px solid rgba(148,163,184,0.65);
        box-shadow: 0 20px 45px rgba(15,23,42,1);
    }

    .action-button.blue {
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        border-color: transparent;
    }

    .action-button.purple {
        background: linear-gradient(135deg, #a855f7, #7c3aed);
        border-color: transparent;
    }

    .action-button.gold {
        background: linear-gradient(135deg, #facc15, #f97316);
        color: #111827;
        border-color: transparent;
    }

    .action-button.red {
        background: linear-gradient(135deg, #ef4444, #b91c1c);
        border-color: transparent;
    }

    .player-card {
        border-radius: 24px;
        background: linear-gradient(145deg, rgba(15,23,42,0.98), rgba(17,24,39,0.98));
        box-shadow:
            0 0 0 1px rgba(55,65,81,0.75),
            0 24px 60px rgba(15,23,42,1);
    }

    .player-card-stripe {
        background: linear-gradient(90deg, #22c55e, #16a34a);
    }

    .countdown-box {
        border-radius: 18px;
        background: linear-gradient(135deg, #fbbf24, #f97316);
        color: #111827;
        box-shadow: 0 20px 45px rgba(250,204,21,0.75);
    }

    .countdown-expired {
        background: linear-gradient(135deg, #ef4444, #b91c1c);
        color: #f9fafb;
        box-shadow: 0 20px 45px rgba(248,113,113,0.95);
    }

    .modal,
    .notifications-modal,
    .search-modal,
    .edit-modal {
        background: rgba(15,23,42,0.9);
        backdrop-filter: blur(10px);
    }

    .modal-content,
    .notifications-container,
    .search-container,
    .edit-container {
        border-radius: 26px;
        background: linear-gradient(145deg, rgba(15,23,42,0.98), rgba(17,24,39,0.98));
        box-shadow:
            0 0 0 1px rgba(148,163,184,0.5),
            0 32px 90px rgba(15,23,42,1);
    }

    .modal-header,
    .search-header,
    .edit-header {
        background: linear-gradient(90deg, #f97316, #fbbf24);
        color: #111827;
        font-weight: 800;
    }

    .notifications-header {
        background: linear-gradient(90deg, #a855f7, #7c3aed);
    }

    .notification-item {
        border-radius: 18px;
        background: rgba(15,23,42,0.98);
        border-right-width: 4px;
    }

    .top-userbar{
        background: rgba(15,23,42,0.96);
        border-radius: 999px;
        border: 1px solid rgba(148,163,184,0.7);
        box-shadow: 0 16px 35px rgba(15,23,42,0.9);
    }

</style>
<style>
    /* === ULTRA ROYAL GALAXY MODE üëë‚ú®=== */
    body {
        background:
            radial-gradient(circle at 0% 0%, rgba(56,189,248,0.24), transparent 55%),
            radial-gradient(circle at 100% 100%, rgba(250,204,21,0.20), transparent 55%),
            radial-gradient(circle at 20% 90%, rgba(129,140,248,0.22), transparent 55%),
            #020617;
        background-size: 140% 140%;
        animation: royalGalaxyMove 26s ease-in-out infinite;
    }

    @keyframes royalGalaxyMove {
        0% { background-position: 0% 0%, 100% 100%, 20% 90%; }
        50% { background-position: 20% 30%, 80% 70%, 0% 60%; }
        100% { background-position: 0% 0%, 100% 100%, 20% 90%; }
    }

    .splash-content::before,
    .login-card::before,
    .section-card::before,
    .player-card::before,
    .stat-card::before {
        content: "";
        position: absolute;
        inset: -1px;
        border-radius: inherit;
        pointer-events: none;
        background:
            linear-gradient(120deg,
                rgba(249,115,22,0.0) 0%,
                rgba(250,204,21,0.75) 45%,
                rgba(129,140,248,0.8) 60%,
                rgba(249,115,22,0.0) 100%);
        opacity: 0;
        transition: opacity .25s ease-out;
        z-index: -1;
    }

    .splash-content:hover::before,
    .login-card:hover::before,
    .section-card:hover::before,
    .player-card:hover::before,
    .stat-card:hover::before {
        opacity: 1;
    }

    .section-card,
    .player-card,
    .stat-card {
        position: relative;
        overflow: hidden;
    }

    .section-card::after,
    .player-card::after {
        content: "";
        position: absolute;
        width: 220%;
        height: 220%;
        top: -60%;
        left: -60%;
        background:
            radial-gradient(circle at 0% 0%, rgba(250,204,21,0.18), transparent 55%),
            radial-gradient(circle at 100% 0%, rgba(129,140,248,0.12), transparent 55%);
        opacity: 0;
        transform: rotate(8deg);
        transition: opacity .28s ease-out, transform .35s ease-out;
        pointer-events: none;
    }

    .section-card:hover::after,
    .player-card:hover::after {
        opacity: 1;
        transform: rotate(0deg);
    }

    .btn-primary,
    .btn-notification,
    .action-btn,
    .action-button,
    .btn-modal,
    .btn-primary-custom {
        position: relative;
        overflow: hidden;
        isolation: isolate;
    }

    .btn-primary::after,
    .btn-notification::after,
    .action-btn::after,
    .action-button::after,
    .btn-modal::after,
    .btn-primary-custom::after {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(circle at 0% 0%, rgba(250,250,250,0.22), transparent 55%);
        opacity: 0;
        transform: translate3d(-30%, -30%, 0);
        transition: opacity .2s ease-out, transform .25s ease-out;
        mix-blend-mode: soft-light;
        pointer-events: none;
        z-index: -1;
    }

    .btn-primary:hover::after,
    .btn-notification:hover::after,
    .action-btn:hover::after,
    .action-button:hover::after,
    .btn-modal:hover::after,
    .btn-primary-custom:hover::after {
        opacity: 0.9;
        transform: translate3d(0, 0, 0);
    }

    .countdown-box {
        position: relative;
        box-shadow:
            0 0 24px rgba(250,204,21,0.85),
            0 0 80px rgba(250,204,21,0.65);
        animation: royalPulse 1.9s ease-in-out infinite;
    }

    .countdown-expired {
        box-shadow:
            0 0 22px rgba(248,113,113,0.9),
            0 0 70px rgba(248,113,113,0.7);
        animation: royalPulseRed 1.4s ease-in-out infinite;
    }

    @keyframes royalPulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }

    @keyframes royalPulseRed {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.06); }
    }

    .header {
        box-shadow:
            0 18px 40px rgba(15,23,42,0.9),
            0 0 60px rgba(129,140,248,0.45);
    }

    .header-text h2 {
        letter-spacing: .06em;
        text-transform: uppercase;
    }

    .dashboard-title {
        letter-spacing: .04em;
        text-transform: uppercase;
        font-size: 23px;
    }

    .players-container,
    .notifications-body,
    .search-results {
        scrollbar-width: thin;
        scrollbar-color: #4b5563 rgba(15,23,42,0.9);
    }
    .players-container::-webkit-scrollbar,
    .notifications-body::-webkit-scrollbar,
    .search-results::-webkit-scrollbar {
        width: 8px;
    }
    .players-container::-webkit-scrollbar-track,
    .notifications-body::-webkit-scrollbar-track,
    .search-results::-webkit-scrollbar-track {
        background: rgba(15,23,42,0.85);
    }
    .players-container::-webkit-scrollbar-thumb,
    .notifications-body::-webkit-scrollbar-thumb,
    .search-results::-webkit-scrollbar-thumb {
        background: #4b5563;
        border-radius: 999px;
    }


</style>
<style>
    /* === HYPER ROYAL OMEGA MODE üöÄüëë=== */
    body {
        background-color: #020617;
        background-image:
            radial-gradient(circle at 0% 0%, rgba(56,189,248,0.35), transparent 55%),
            radial-gradient(circle at 100% 0%, rgba(168,85,247,0.32), transparent 55%),
            radial-gradient(circle at 0% 100%, rgba(250,204,21,0.3), transparent 55%),
            radial-gradient(circle at 100% 100%, rgba(59,130,246,0.3), transparent 55%);
        background-size: 160% 160%;
        animation: hyperGalaxy 32s ease-in-out infinite;
    }

    @keyframes hyperGalaxy {
        0%   { background-position: 0% 0%, 100% 0%, 0% 100%, 100% 100%; }
        50%  { background-position: 20% 30%, 80% 10%, 10% 80%, 90% 90%; }
        100% { background-position: 0% 0%, 100% 0%, 0% 100%, 100% 100%; }
    }

    /* Floating stars layer */
    body::before {
        content: "";
        position: fixed;
        inset: 0;
        pointer-events: none;
        background-image:
            radial-gradient(circle, rgba(248,250,252,0.85) 0, transparent 55%),
            radial-gradient(circle, rgba(248,250,252,0.75) 0, transparent 55%),
            radial-gradient(circle, rgba(248,250,252,0.9) 0, transparent 55%);
        background-size: 2px 2px, 3px 3px, 1px 1px;
        background-position:
            10% 20%,
            70% 80%,
            40% 60%;
        opacity: 0.16;
        mix-blend-mode: screen;
        z-index: -1;
        animation: starDrift 26s linear infinite;
    }

    @keyframes starDrift {
        0%   { transform: translate3d(0,0,0); }
        50%  { transform: translate3d(-15px,-25px,0); }
        100% { transform: translate3d(0,0,0); }
    }

    .splash-content,
    .login-card,
    .section-card,
    .player-card,
    .stat-card,
    .modal-content,
    .notifications-container,
    .search-container,
    .edit-container {
        position: relative;
        background:
            linear-gradient(135deg, rgba(15,23,42,0.92), rgba(17,24,39,0.98)),
            radial-gradient(circle at top left, rgba(148,163,184,0.25), transparent 55%);
        backdrop-filter: blur(14px);
    }

    .splash-content,
    .login-card {
        border-radius: 28px !important;
    }

    .splash-content::after,
    .login-card::after,
    .section-card::after,
    .player-card::after,
    .stat-card::after {
        content: "";
        position: absolute;
        inset: -1px;
        pointer-events: none;
        border-radius: inherit;
        border: 1px solid rgba(248,250,252,0.06);
        box-shadow:
            inset 0 0 0 1px rgba(15,23,42,0.85),
            0 0 30px rgba(15,23,42,0.95);
        mix-blend-mode: soft-light;
    }

    .section-card,
    .player-card,
    .stat-card {
        box-shadow:
            0 0 0 1px rgba(148,163,184,0.45),
            0 32px 90px rgba(15,23,42,1),
            0 0 120px rgba(59,130,246,0.55);
    }

    .section-card:hover,
    .player-card:hover {
        transform: translateY(-5px) scale(1.01);
        box-shadow:
            0 0 0 1px rgba(250,204,21,0.85),
            0 40px 110px rgba(15,23,42,1),
            0 0 160px rgba(250,204,21,0.8);
    }

    .header {
        box-shadow:
            0 20px 50px rgba(15,23,42,0.98),
            0 0 120px rgba(129,140,248,0.65);
    }

    .header-logo {
        position: relative;
        overflow: hidden;
    }

    .header-logo::after {
        content: "";
        position: absolute;
        inset: -40%;
        background:
            conic-gradient(from 0deg,
                rgba(250,204,21,0.0),
                rgba(250,204,21,0.72),
                rgba(129,140,248,0.8),
                rgba(250,204,21,0.0));
        animation: spinAura 12s linear infinite;
        opacity: 0.65;
        mix-blend-mode: soft-light;
    }

    @keyframes spinAura {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .dashboard-title,
    .section-title-main {
        text-transform: uppercase;
        letter-spacing: 0.12em;
        font-size: 0.9rem;
    }

    .dashboard-title {
        font-size: 1.1rem;
    }

    .btn-primary,
    .btn-notification,
    .action-btn,
    .action-button,
    .btn-modal,
    .btn-primary-custom {
        box-shadow:
            0 18px 48px rgba(15,23,42,1),
            0 0 40px rgba(250,204,21,0.5);
    }

    .btn-primary:hover,
    .btn-notification:hover,
    .action-btn:hover,
    .action-button:hover,
    .btn-modal:hover,
    .btn-primary-custom:hover {
        transform: translateY(-1px) scale(1.01);
        box-shadow:
            0 22px 60px rgba(15,23,42,1),
            0 0 55px rgba(250,204,21,0.75);
    }

    .countdown-box {
        border: 1px solid rgba(250,204,21,0.65);
    }

    .countdown-expired {
        border-color: rgba(248,113,113,0.9);
    }


</style>
</head>
<body>

    <!-- Google user info bar -->
    <div id="googleUserBar" class="top-userbar" dir="rtl">
        <img id="gUserPic" src="" alt="user"/>
        <div>
            <div class="name" id="gUserName"></div>
            <div class="email" id="gUserEmail"></div>
        </div>
        <button class="btn-logout" onclick="googleLogout()">ÿÆÿ±Ÿàÿ¨</button>
    </div>

    <!-- ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ -->
    <div id="splash-screen">
        <div class="splash-content">
            <div class="splash-icon">üéì</div>
            <div class="splash-title">ÿ¨ÿßŸÖÿπÿ© ÿßŸÑÿ£ŸÜÿ®ÿßÿ±</div>
            <div class="splash-subtitle">Al-Anbar University</div>
            <div class="splash-system-title">üé±üéÆ ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿµÿßŸÑÿ© ÿßŸÑŸÖÿ≤ÿØŸàÿ¨</div>
            <div class="splash-system-subtitle">Billiard + PlayStation Management System</div>
            <div class="progress-container">
                <div class="progress-bar" id="progress"></div>
            </div>
            <div class="splash-version">Version 3.0 Pro ‚Ä¢ 2024</div>
            <div class="splash-developer">ÿ™ÿ∑ŸàŸäÿ±: ŸÖÿ¨ÿ™ÿ®Ÿâ ÿßŸÑÿØŸÅÿßÿπŸä</div>
        </div>
    </div>

    <!-- ÿ¥ÿßÿ¥ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ -->
    <div id="login-screen">
        <div class="login-container fade-in">
            <div class="logo-section">
                <div class="logo-icon">üéì</div>
                <div class="logo-title-ar">ÿ¨ÿßŸÖÿπÿ© ÿßŸÑÿ£ŸÜÿ®ÿßÿ±</div>
                <div class="logo-title-en">Al-Anbar University</div>
            </div>

            <div class="login-card">
                <div class="card-accent"></div>
                <div class="card-content">
                    <h2 class="card-title">üé±üéÆ ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ®ŸÑŸäÿßÿ±ÿØŸà ŸàÿßŸÑÿ®ŸÑÿßŸäÿ≥ÿ™Ÿäÿ¥ŸÜ</h2>
                    <p class="card-subtitle">Professional Edition</p>
                    <p class="card-location">ÿßŸÑÿ£ŸÇÿ≥ÿßŸÖ ÿßŸÑÿØÿßÿÆŸÑŸäÿ© - ÿ¨ÿßŸÖÿπÿ© ÿßŸÑÿ£ŸÜÿ®ÿßÿ±</p>

                    <form id="login-form" onsubmit="handleLogin(event)">
                        <div class="input-group">
                            <label class="input-label">üë§ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ</label>
                            <div class="input-wrapper">
                                <input type="text" class="input-field" id="username" placeholder="ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ" required>
                            </div>
                        </div>

                        <div class="input-group">
                            <label class="input-label">üîí ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±</label>
                            <div class="input-wrapper">
                                <input type="password" class="input-field" id="password" placeholder="ÿ£ÿØÿÆŸÑ ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±" required>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary">üîì ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ</button>
                    
                        <!-- Google Sign-In (official button) -->
                        <div class="google-login-wrap" style="text-align:center;margin-top:16px">
                            <div id="g_id_onload"
                                data-client_id="152994650455-26obvvupjseuf62eb52il44g4pcc965i.apps.googleusercontent.com"
                                data-context="signin"
                                data-ux_mode="popup"
                                data-callback="handleCredentialResponse"
                                data-auto_prompt="false"></div>
                            <div class="g_id_signin" data-type="standard" data-size="large" data-theme="outline" data-shape="rectangular"></div>
                        </div>
                    </form>
                </div>
            </div>

            <div class="footer-info">
                <div class="footer-copyright">¬© 2024 ÿ¨ÿßŸÖÿπÿ© ÿßŸÑÿ£ŸÜÿ®ÿßÿ± | ÿ™ÿ∑ŸàŸäÿ±: ŸÖÿ¨ÿ™ÿ®Ÿâ ÿßŸÑÿØŸÅÿßÿπŸä</div>
                <div class="footer-version">Professional Edition ‚Ä¢ Version 3.0 Pro</div>
            </div>
        </div>
    </div>

    <!-- ÿßŸÑŸàÿßÿ¨Ÿáÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© -->
    <div id="main-interface">
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <div class="header-logo">
                        <div class="header-logo-icon">üéì</div>
                        <div class="header-logo-games">üé±üéÆ</div>
                    </div>
                    <div class="header-text">
                        <h1>ÿ¨ÿßŸÖÿπÿ© ÿßŸÑÿ£ŸÜÿ®ÿßÿ± - ÿßŸÑÿ£ŸÇÿ≥ÿßŸÖ ÿßŸÑÿØÿßÿÆŸÑŸäÿ©</h1>
                        <h2>ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ®ŸÑŸäÿßÿ±ÿØŸà ŸàÿßŸÑÿ®ŸÑÿßŸäÿ≥ÿ™Ÿäÿ¥ŸÜ</h2>
                        <p>Al-Anbar University ‚Ä¢ Billiard & PlayStation Management System</p>
                    </div>
                </div>
                <div class="header-right">
                    <div class="user-info">
                        <div class="user-details">
                            <div class="user-name" id="current-user-name">üë§ ÿßŸÑŸÖÿØŸäÿ±</div>
                            <div class="user-role">ŸÖÿØŸäÿ± ‚Ä¢ ŸÜÿ¥ÿ∑ ÿßŸÑÿ¢ŸÜ</div>
                        </div>
                        <button class="btn-notification" onclick="showNotifications()">üîî</button>
                    </div>
                    <div class="header-actions">
                        <div class="time-display" id="time-display">00:00:00</div>
                        <button class="btn-logout" onclick="handleLogout()">üö™ ÿÆÿ±Ÿàÿ¨</button>
                    </div>
                </div>
            </div>
        </header>

        <main class="dashboard" id="main-dashboard">
            <h1 class="dashboard-title">ÿßÿÆÿ™ÿ± ÿßŸÑŸÇÿ≥ŸÖ ÿßŸÑÿ∞Ÿä ÿ™ÿ±ŸäÿØ ÿ•ÿØÿßÿ±ÿ™Ÿá:</h1>
            
            <div class="dashboard-sections">
                <div class="section-card" onclick="openBilliardDashboard()">
                    <div class="section-icon">üé±</div>
                    <h2 class="section-title">ÿµÿßŸÑÿ© ÿßŸÑÿ®ŸÑŸäÿßÿ±ÿØŸà</h2>
                    <p class="section-description">ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ∑ÿßŸàŸÑÿßÿ™ ŸàÿßŸÑŸÑÿßÿπÿ®ŸäŸÜ ŸàÿßŸÑÿ¨ŸÑÿ≥ÿßÿ™</p>
                </div>

                <div class="section-card ps" onclick="openPSDashboard()">
                    <div class="section-icon">üéÆ</div>
                    <h2 class="section-title">ÿµÿßŸÑÿ© ÿßŸÑÿ®ŸÑÿßŸäÿ≥ÿ™Ÿäÿ¥ŸÜ</h2>
                    <p class="section-description">ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ£ÿ¨Ÿáÿ≤ÿ© ŸàÿßŸÑŸÑÿßÿπÿ®ŸäŸÜ ŸàÿßŸÑÿ¨ŸÑÿ≥ÿßÿ™</p>
                </div>
            </div>

            <div class="quick-actions">
                <button class="action-btn" onclick="openAdvancedSearch()">üîç ÿ®ÿ≠ÿ´ ŸÖÿ™ŸÇÿØŸÖ</button>
                <button class="action-btn purple" onclick="showNotifications()">üîî ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™</button>
            </div>
        </main>

        <div id="section-view" class="section-dashboard hidden"></div>
    </div>

    <!-- ŸÜŸÖŸàÿ∞ÿ¨ ÿ™ÿ≥ÿ¨ŸäŸÑ ŸÑÿßÿπÿ® -->
    <div id="register-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header" id="modal-title">‚ûï ÿ™ÿ≥ÿ¨ŸäŸÑ ŸÑÿßÿπÿ® ÿ¨ÿØŸäÿØ</div>
            <div class="modal-body">
                <form id="register-form" onsubmit="handleRegisterPlayer(event)">
                    <div class="form-group">
                        <label class="form-label">üë§ ÿßÿ≥ŸÖ ÿßŸÑŸÑÿßÿπÿ®</label>
                        <input type="text" class="form-input" id="player-name" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" id="table-label">üéØ ÿ±ŸÇŸÖ ÿßŸÑÿ∑ÿßŸàŸÑÿ©</label>
                        <input type="text" class="form-input" id="table-number" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">üí∞ ÿ≥ÿπÿ± ÿßŸÑÿ≥ÿßÿπÿ© (ÿØ.ÿπ)</label>
                        <input type="number" class="form-input" id="hourly-rate" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">‚è≥ ÿßŸÑŸÖÿØÿ© (ÿØŸÇÿßÿ¶ŸÇ)</label>
                        <select class="form-select" id="duration">
                            <option value="10">10 ÿØŸÇÿßÿ¶ŸÇ</option>
                            <option value="15">15 ÿØŸÇŸäŸÇÿ©</option>
                            <option value="30">30 ÿØŸÇŸäŸÇÿ©</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">üìù ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</label>
                        <input type="text" class="form-input" id="player-notes">
                    </div>

                    <div class="info-box">
                        <p>‚ÑπÔ∏è ŸàŸÇÿ™ ÿßŸÑÿ®ÿØÿ° Ÿäÿ≥ÿ¨ŸÑ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ÿπŸÜÿØ ÿßŸÑÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿ™ÿ≥ÿ¨ŸäŸÑ</p>
                        <p>üíµ ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä: <span id="default-rate">5000</span> ÿØ.ÿπ/ÿ≥ÿßÿπÿ©</p>
                        <p>‚è≥ ÿßŸÑÿπÿØÿßÿØ ÿßŸÑÿ™ŸÜÿßÿ≤ŸÑŸä Ÿäÿ¥ÿ™ÿ∫ŸÑ ŸÖÿ®ÿßÿ¥ÿ± ÿ≠ÿ≥ÿ® ÿßŸÑŸÖÿØÿ© ÿßŸÑŸÑŸä ÿ™ÿÆÿ™ÿßÿ±Ÿáÿß</p>
                    </div>

                    <div class="modal-footer">
                        <button type="submit" class="btn-modal btn-save">üíæ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑŸÑÿßÿπÿ®</button>
                        <button type="button" class="btn-modal btn-cancel" onclick="closeRegisterModal()">‚Ü© ÿ±ÿ¨Ÿàÿπ</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ -->
    <div id="notifications-modal" class="notifications-modal">
        <div class="notifications-container">
            <div class="notifications-header">
                <span>üîî ŸÖÿ±ŸÉÿ≤ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™</span>
                <button class="notifications-close" onclick="closeNotifications()">√ó</button>
            </div>
            <div class="notifications-body" id="notifications-list"></div>
        </div>
    </div>

    <!-- ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ®ÿ≠ÿ´ -->
    <div id="search-modal" class="search-modal">
        <div class="search-container">
            <div class="search-header">üîç ÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™ (ÿ®ŸÑŸäÿßÿ±ÿØŸà + ÿ®ŸÑÿßŸäÿ≥ÿ™Ÿäÿ¥ŸÜ)</div>
            <div class="search-body">
                <div class="search-input-group">
                    <input 
                        type="text" 
                        class="search-input" 
                        id="search-input" 
                        placeholder="ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿ¨ŸÑÿ≥ÿ© ÿ®ÿßŸÑÿßÿ≥ŸÖ ÿ£Ÿà ÿ±ŸÇŸÖ ÿßŸÑÿ∑ÿßŸàŸÑÿ© / ÿßŸÑÿ¨Ÿáÿßÿ≤"
                        onkeyup="handleSearch(event)"
                    >
                </div>
                <div class="search-results" id="search-results"></div>
                <div class="search-buttons">
                    <button class="btn-primary-custom" onclick="performSearch()">üîç ÿ®ÿ≠ÿ´</button>
                    <button class="btn-secondary-custom" onclick="closeSearchModal()">‚Üê ÿ•ÿ∫ŸÑÿßŸÇ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ™ÿπÿØŸäŸÑ -->
    <div id="edit-modal" class="edit-modal">
        <div class="edit-container">
            <div class="edit-header">‚úèÔ∏è ÿ™ÿπÿØŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ¨ŸÑÿ≥ÿ©</div>
            <div class="edit-body">
                <form id="edit-form" onsubmit="handleEditPlayer(event)">
                    <div class="form-group">
                        <label class="form-label">üë§ ÿßŸÑÿßÿ≥ŸÖ</label>
                        <input type="text" class="form-input" id="edit-name" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" id="edit-table-label">üéØ ÿ±ŸÇŸÖ ÿßŸÑÿ∑ÿßŸàŸÑÿ©</label>
                        <input type="text" class="form-input" id="edit-table" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">üí∞ ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿÆÿßÿµ (ÿØ.ÿπ/ÿ≥ÿßÿπÿ©)</label>
                        <div class="current-info">
                            <p>ÿßŸÑÿ≠ÿßŸÑŸä: <span id="edit-current-rate"></span> ÿØ.ÿπ/ÿ≥ÿßÿπÿ©</p>
                        </div>
                        <input type="number" class="form-input" id="edit-rate" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">üìù ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™</label>
                        <input type="text" class="form-input" id="edit-notes">
                    </div>

                    <div class="form-group">
                        <label class="form-label">‚è≥ ÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÖÿ™ÿ®ŸÇŸä (ÿ®ÿßŸÑÿ´ŸàÿßŸÜŸä)</label>
                        <input type="number" class="form-input" id="edit-remaining" required>
                    </div>

                    <div class="modal-footer">
                        <button type="submit" class="btn-modal btn-save">‚úî ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿπÿØŸäŸÑÿßÿ™</button>
                        <button type="button" class="btn-modal btn-cancel" onclick="closeEditModal()">‚úï ÿ•ŸÑÿ∫ÿßÿ°</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="edit-container">
            <div class="edit-header">‚öôÔ∏è ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™</div>
            <div class="edit-body">
                <div style="display:flex; gap:8px; margin-bottom:10px;">
                    <button class="btn-primary-custom" onclick="showSettingsTab('account')">ÿßŸÑÿ≠ÿ≥ÿßÿ®</button>
                    <button class="btn-secondary-custom" onclick="showSettingsTab('appearance')">ÿßŸÑŸÖÿ∏Ÿáÿ±</button>
                    <button class="btn-secondary-custom" onclick="showSettingsTab('backup')">ÿßŸÑŸÜÿ≥ÿÆ ÿßŸÑÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿä</button>
                    <button class="btn-secondary-custom" onclick="showSettingsTab('users')">ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸàŸÜ</button>
                </div>

                <div id="tab-account">
                    <div class="form-group">
                        <label class="form-label">üë§ ÿßÿ≥ŸÖ ÿßŸÑÿπÿ±ÿ∂</label>
                        <input id="set-display-name" class="form-input" placeholder="ÿßÿ≥ŸÖ Ÿäÿ∏Ÿáÿ± ÿ£ÿπŸÑŸâ ŸäŸÖŸäŸÜ" />
                    </div>
                    <div class="form-group">
                        <label class="form-label">üîí ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)</label>
                        <input id="set-password" type="password" class="form-input" placeholder="ÿßÿ™ÿ±ŸÉŸáÿß ŸÅÿßÿ±ÿ∫ÿ© ÿ•ÿ∞ÿß ŸÖÿß ÿ™ÿ±ŸäÿØ ÿ™ÿ∫ŸäŸäÿ±" />
                    </div>
                    <button class="btn-primary-custom" onclick="saveAccountSettings()">üíæ ÿ≠ŸÅÿ∏</button>
                </div>

                <div id="tab-appearance" style="display:none">
                    <div class="form-group">
                        <label class="form-label">üé® ÿßŸÑÿ´ŸäŸÖ</label>
                        <select id="theme-select" class="form-select">
                            <option value="gold">ÿ∞Ÿáÿ®Ÿä</option>
                            <option value="blue">ÿ£ÿ≤ÿ±ŸÇ</option>
                            <option value="dark">ÿ£ÿ≥ŸàÿØ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">üîî ÿµŸàÿ™ ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑŸàŸÇÿ™</label>
                        <select id="notif-sound" class="form-select">
                            <option value="on">ÿ™ÿ¥ÿ∫ŸäŸÑ</option>
                            <option value="off">ÿ•ŸäŸÇÿßŸÅ</option>
                        </select>
                    </div>
                    <button class="btn-primary-custom" onclick="saveAppearance()">‚úÖ ÿ™ÿ∑ÿ®ŸäŸÇ</button>
                </div>

                <div id="tab-backup" style="display:none">
                    <div class="info-box">
                        <p>ŸäŸÜÿ≠ŸÅÿ∏ ŸÉŸÑ ÿ¥Ÿäÿ° ŸÖÿ≠ŸÑŸäÿßŸã ÿ®ÿßŸÑŸÖÿ™ÿµŸÅÿ≠ ŸÑŸÉŸÑ ŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÑŸàÿ≠ÿØŸá.</p>
                    </div>
                    <button class="btn-primary-custom" onclick="exportUserData()">‚¨áÔ∏è ÿ™ÿµÿØŸäÿ± ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ</button>
                    <input type="file" id="import-file" accept="application/json" style="display:none" />
                    <button class="btn-secondary-custom" onclick="document.getElementById('import-file').click()">‚¨ÜÔ∏è ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ</button>
                </div>

                <div id="tab-users" style="display:none">
                    <div class="form-group">
                        <label class="form-label">üë§ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ¨ÿØŸäÿØ</label>
                        <input id="new-username" class="form-input" placeholder="ŸÖÿ´ÿßŸÑ: ali" />
                    </div>
                    <div class="form-group">
                        <label class="form-label">üîí ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±</label>
                        <input id="new-password" type="password" class="form-input" />
                    </div>
                    <div class="form-group">
                        <label class="form-label">üéöÔ∏è ÿßŸÑÿØŸàÿ±</label>
                        <select id="new-role" class="form-select">
                            <option value="ŸÖÿØŸäÿ±">ŸÖÿØŸäÿ±</option>
                            <option value="ŸÖÿ≥ÿ™ÿÆÿØŸÖ">ŸÖÿ≥ÿ™ÿÆÿØŸÖ</option>
                        </select>
                    </div>
                    <button class="btn-primary-custom" onclick="createUserFromSettings()">‚ûï ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ≥ÿ™ÿÆÿØŸÖ</button>

                    <div class="info-box" style="margin-top:14px">
                        <p>ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ:</p>
                        <div id="users-list" style="font-size:12px;color:#8b949e"></div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button class="btn-secondary-custom" onclick="closeSettings()">‚úï ÿ•ÿ∫ŸÑÿßŸÇ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Days Log Modal -->
    <div id="dayslog-modal" class="modal">
        <div class="edit-container">
            <div class="edit-header">üìÖ ÿ≥ÿ¨ŸÑ ÿßŸÑÿ£ŸäÿßŸÖ</div>
            <div class="edit-body">
                <div class="form-group">
                    <label class="form-label">ÿßÿÆÿ™ŸÄÿ± ŸäŸàŸÖ</label>
                    <input type="date" id="days-date" class="form-input" />
                </div>
                <div id="days-result" class="players-container"></div>
                <div class="modal-footer">
                    <button class="btn-secondary-custom" onclick="closeDaysLog()">ÿ•ÿ∫ŸÑÿßŸÇ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Analytics Modal -->
    <div id="analytics-modal" class="modal">
        <div class="edit-container">
            <div class="edit-header">üìä ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑÿßÿ™</div>
            <div class="edit-body">
                <div class="stats-grid" id="analytics-cards"></div>
                <div class="modal-footer">
                    <button class="btn-secondary-custom" onclick="closeAnalytics()">ÿ•ÿ∫ŸÑÿßŸÇ</button>
                </div>
            </div>
        </div>
    </div>

    <audio id="beep" preload="auto">
        <source src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABYAAAAA//8AAP//AAD//wAA" type="audio/wav">
    </audio>

    <script>
        const APP_DATA = {
            users: {
                admin: {
                    password: '240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9',
                    name: 'ÿßŸÑŸÖÿØŸäÿ±',
                    role: 'ŸÖÿØŸäÿ±'
                }
            },
            currentUser: null,
            billiard: {
                activePlayers: [],
                completedSessions: [],
                hourlyRate: 5000
            },
            ps: {
                activePlayers: [],
                completedSessions: [],
                hourlyRate: 7000
            },
            notifications: []
        };

        let currentMode = null;
        let editingPlayerId = null;
        const countdownIntervals = {};

        function loadData() {
            const saved = localStorage.getItem('billiardSystemData');
            if (saved) {
                const data = JSON.parse(saved);
                Object.assign(APP_DATA, data);
            }
        }

        function saveData() {
            localStorage.setItem('billiardSystemData', JSON.stringify(APP_DATA));
        }

        async function hashPassword(password) {
            const encoder = new TextEncoder();
            const data = encoder.encode(password);
            const hash = await crypto.subtle.digest('SHA-256', data);
            return Array.from(new Uint8Array(hash))
                .map(b => b.toString(16).padStart(2, '0'))
                .join('');
        }

        window.addEventListener('load', () => {
            loadData();
            let progress = 0;
            const progressBar = document.getElementById('progress');
            
            const interval = setInterval(() => {
                progress += 2;
                progressBar.style.width = progress + '%';
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        document.getElementById('splash-screen').style.display = 'none';
                        document.getElementById('login-screen').style.display = 'block';
                    }, 300);
                }
            }, 20);
        });

        async function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (!username || !password) {
                alert('ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸàŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±');
                return;
            }
            
            const hashedPassword = await hashPassword(password);
            
            if (APP_DATA.users[username] && APP_DATA.users[username].password === hashedPassword) {
                APP_DATA.currentUser = {
                    username: username,
                    name: APP_DATA.users[username].name,
                    role: APP_DATA.users[username].role
                };
                
                document.getElementById('current-user-name').textContent = 'üë§ ' + APP_DATA.currentUser.name;
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('main-interface').style.display = 'block';
                
                startClock();
                updateNotificationBadge();
                addNotification('ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ ÿ¨ÿØŸäÿØ', `${APP_DATA.currentUser.name} ŸÇÿßŸÖ ÿ®ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ`, 'success');
            } else {
                alert('ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ£Ÿà ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©');
                document.getElementById('password').value = '';
            }
        }

        function handleLogout() {
            if (confirm('ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ÿü')) {
                addNotification('üö™ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿÆÿ±Ÿàÿ¨', `${APP_DATA.currentUser.name} ŸÇÿßŸÖ ÿ®ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨`, 'info');
                
                Object.keys(countdownIntervals).forEach(key => {
                    clearInterval(countdownIntervals[key]);
                });
                
                APP_DATA.currentUser = null;
                currentMode = null;
                document.getElementById('main-interface').style.display = 'none';
                document.getElementById('login-screen').style.display = 'block';
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                document.getElementById('main-dashboard').classList.remove('hidden');
                document.getElementById('section-view').classList.add('hidden');
            }
        }

        function startClock() {
            updateClock();
            setInterval(updateClock, 1000);
        }

        function updateClock() {
            const now = new Date();
            const hours = now.getHours() % 12 || 12;
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            const ampm = now.getHours() >= 12 ? 'PM' : 'AM';
            
            document.getElementById('time-display').textContent = `${hours}:${minutes}:${seconds} ${ampm}`;
        }

        function addNotification(title, message, type = 'info') {
            const notification = {
                id: Date.now(),
                title: title,
                message: message,
                type: type,
                time: new Date().toLocaleString('ar-IQ'),
                read: false
            };
            
            APP_DATA.notifications.unshift(notification);
            if (APP_DATA.notifications.length > 80) {
                APP_DATA.notifications = APP_DATA.notifications.slice(0, 80);
            }
            
            saveData();
            updateNotificationBadge();
        }

        function updateNotificationBadge() {
            const unreadCount = APP_DATA.notifications.filter(n => !n.read).length;
            const notifBtn = document.querySelector('.btn-notification');
            if (notifBtn) {
                notifBtn.textContent = unreadCount > 0 ? `üîî ${unreadCount}` : 'üîî';
                notifBtn.style.background = unreadCount > 0 ? '#1f6feb' : '#6e7681';
            }
        }

        function showNotifications() {
            const notificationsList = document.getElementById('notifications-list');
            
            if (APP_DATA.notifications.length === 0) {
                notificationsList.innerHTML = `
                    <div class="empty-notifications">
                        <div class="empty-notifications-icon">üî≠</div>
                        <div class="empty-notifications-text">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™</div>
                    </div>
                `;
            } else {
                notificationsList.innerHTML = APP_DATA.notifications.map(notif => {
                    const typeClass = notif.type || 'info';
                    return `
                        <div class="notification-item ${typeClass}">
                            <div class="notification-title">${notif.title}</div>
                            <div class="notification-message">${notif.message}</div>
                            <div class="notification-time">${notif.time}</div>
                        </div>
                    `;
                }).join('');
                
                APP_DATA.notifications.forEach(n => n.read = true);
                saveData();
                updateNotificationBadge();
            }
            
            document.getElementById('notifications-modal').style.display = 'block';
        }

        function closeNotifications() {
            document.getElementById('notifications-modal').style.display = 'none';
        }

        function openBilliardDashboard() {
            currentMode = 'billiard';
            showSectionDashboard();
        }

        function openPSDashboard() {
            currentMode = 'ps';
            showSectionDashboard();
        }

        function showSectionDashboard() {
            document.getElementById('main-dashboard').classList.add('hidden');
            const sectionView = document.getElementById('section-view');
            sectionView.classList.remove('hidden');
            
            const mode = currentMode;
            const data = APP_DATA[mode];
            const icon = mode === 'billiard' ? 'üé±' : 'üéÆ';
            const title = mode === 'billiard' ? 'ÿßŸÑÿ®ŸÑŸäÿßÿ±ÿØŸà' : 'ÿßŸÑÿ®ŸÑÿßŸäÿ≥ÿ™Ÿäÿ¥ŸÜ';
            
            const activeCount = data.activePlayers.length;
            const totalRevenue = data.completedSessions.reduce((sum, s) => sum + s.cost, 0);
            const completedCount = data.completedSessions.length;
            const avgSession = completedCount > 0 ? Math.floor(totalRevenue / completedCount) : 0;
            
            sectionView.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card-accent" style="background: #238636"></div>
                        <div class="stat-card-content">
                            <div class="stat-icon">üë•</div>
                            <div class="stat-value">${activeCount}</div>
                            <div class="stat-label">ŸÑÿßÿπÿ®ŸäŸÜ ŸÜÿ¥ÿ∑ŸäŸÜ</div>
                            <span class="stat-badge" style="background: #238636; color: white">üü¢ ŸÜÿ¥ÿ∑</span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-card-accent" style="background: #d4af37"></div>
                        <div class="stat-card-content">
                            <div class="stat-icon">üí∞</div>
                            <div class="stat-value">${totalRevenue.toLocaleString()}</div>
                            <div class="stat-label">ÿ£ÿ±ÿ®ÿßÿ≠ ÿßŸÑŸäŸàŸÖ (ÿØ.ÿπ)</div>
                            <span class="stat-badge" style="background: #d4af37; color: white">ÿßŸÑŸäŸàŸÖ</span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-card-accent" style="background: #1f6feb"></div>
                        <div class="stat-card-content">
                            <div class="stat-icon">üìã</div>
                            <div class="stat-value">${completedCount}</div>
                            <div class="stat-label">ÿ¨ŸÑÿ≥ÿßÿ™ ŸÖŸÉÿ™ŸÖŸÑÿ©</div>
                            <span class="stat-badge" style="background: #1f6feb; color: white">ŸÖŸÉÿ™ŸÖŸÑ</span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-card-accent" style="background: #8957e5"></div>
                        <div class="stat-card-content">
                            <div class="stat-icon">‚ö°</div>
                            <div class="stat-value">${avgSession.toLocaleString()}</div>
                            <div class="stat-label">ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑÿ¨ŸÑÿ≥ÿ© (ÿØ.ÿπ)</div>
                            <span class="stat-badge" style="background: #8957e5; color: white">ŸÖÿ™Ÿàÿ≥ÿ∑</span>
                        </div>
                    </div>
                </div>

                <h2 class="section-title-main">${icon} ÿ•ÿØÿßÿ±ÿ© ÿµÿßŸÑÿ© ${title}</h2>

                <div class="action-buttons">
                    <button class="action-button" onclick="openRegisterModal()">‚ûï ÿ™ÿ≥ÿ¨ŸäŸÑ ŸÑÿßÿπÿ® ÿ¨ÿØŸäÿØ</button>
                    <button class="action-button blue" onclick="showActivePlayers()">üë• ÿßŸÑŸÑÿßÿπÿ®ŸäŸÜ (${activeCount})</button>
                    <button class="action-button purple" onclick="showHistory()">üìã ÿ≥ÿ¨ŸÑ ÿßŸÑŸäŸàŸÖ</button>
                    <button class="action-button gold" onclick="openDaysLog()">üìÖ ÿ≥ÿ¨ŸÑ ÿßŸÑÿ£ŸäÿßŸÖ</button>
                    <button class="action-button red" onclick="openAnalytics()">üìä ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑÿßÿ™</button>
                    <button class="action-button" style="background: #8b4513;" onclick="archivePlayers()">üì¶ ÿ£ÿ±ÿ¥ŸÅÿ© ÿßŸÑŸÑÿßÿπÿ®ŸäŸÜ</button>
                    <button class="action-button" style="background: #dc143c;" onclick="resetPlayers()">üîÑ ÿ±Ÿäÿ≥ÿ™ ÿßŸÑŸÑÿßÿπÿ®ŸäŸÜ</button>
                    <button class="action-button gray" onclick="openSettings()">‚öôÔ∏è ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™</button>
                </div>

                <button class="action-button gray" style="margin-top: 20px;" onclick="backToMain()">‚Ü© ÿ±ÿ¨Ÿàÿπ ŸÑŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</button>
            `;
        }

        function backToMain() {
            Object.keys(countdownIntervals).forEach(key => {
                clearInterval(countdownIntervals[key]);
                delete countdownIntervals[key];
            });
            
            document.getElementById('section-view').classList.add('hidden');
            document.getElementById('main-dashboard').classList.remove('hidden');
            currentMode = null;
        }

        function openRegisterModal() {
            const mode = currentMode;
            const rate = APP_DATA[mode].hourlyRate;
            const icon = mode === 'billiard' ? 'üé±' : 'üéÆ';
            const title = mode === 'billiard' ? 'ÿ®ŸÑŸäÿßÿ±ÿØŸà' : 'ÿ®ŸÑÿßŸäÿ≥ÿ™Ÿäÿ¥ŸÜ';
            const tableLabel = mode === 'billiard' ? 'üéØ ÿ±ŸÇŸÖ ÿßŸÑÿ∑ÿßŸàŸÑÿ©' : 'üéÆ ÿ±ŸÇŸÖ ÿßŸÑÿ¨Ÿáÿßÿ≤ (1-4)';
            
            document.getElementById('modal-title').textContent = `‚ûï ÿ™ÿ≥ÿ¨ŸäŸÑ ŸÑÿßÿπÿ® ÿ¨ÿØŸäÿØ - ${title} ${icon}`;
            document.getElementById('table-label').textContent = tableLabel;
            document.getElementById('hourly-rate').value = rate;
            document.getElementById('default-rate').textContent = rate.toLocaleString();
            
            document.getElementById('register-modal').style.display = 'block';
        }

        function closeRegisterModal() {
            document.getElementById('register-modal').style.display = 'none';
            document.getElementById('register-form').reset();
        }

        function handleRegisterPlayer(event) {
            event.preventDefault();
            
            const name = document.getElementById('player-name').value.trim();
            const tableNumber = document.getElementById('table-number').value.trim();
            const rate = parseInt(document.getElementById('hourly-rate').value);
            const duration = parseInt(document.getElementById('duration').value);
            const notes = document.getElementById('player-notes').value.trim();
            
            const player = {
                id: Date.now(),
                name: name,
                tableNumber: tableNumber,
                startTime: Date.now(),
                customRate: rate,
                notes: notes,
                remaining: duration * 60,
                initialMinutes: duration,
                overtimeAlerted: false,
                timeFinishedAlerted: false
            };
            
            APP_DATA[currentMode].activePlayers.push(player);
            saveData();
            
            addNotification(
                '‚úî ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ¨ÿØŸäÿØ',
                `ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ${name} ÿπŸÑŸâ ${currentMode === 'billiard' ? 'ÿßŸÑÿ∑ÿßŸàŸÑÿ©' : 'ÿßŸÑÿ¨Ÿáÿßÿ≤'} ${tableNumber} ŸÑŸÖÿØÿ© ${duration} ÿØŸÇŸäŸÇÿ©`,
                'success'
            );
            
            closeRegisterModal();
            showActivePlayers();
        }

        function showActivePlayers() {
            const mode = currentMode;
            const players = APP_DATA[mode].activePlayers;
            const icon = mode === 'billiard' ? 'üé±' : 'üéÆ';
            const title = mode === 'billiard' ? 'ÿ®ŸÑŸäÿßÿ±ÿØŸà' : 'ÿ®ŸÑÿßŸäÿ≥ÿ™Ÿäÿ¥ŸÜ';
            const deviceLabel = mode === 'billiard' ? 'ÿßŸÑÿ∑ÿßŸàŸÑÿ©' : 'ÿßŸÑÿ¨Ÿáÿßÿ≤';
            
            const sectionView = document.getElementById('section-view');
            
            if (players.length === 0) {
                sectionView.innerHTML = `
                    <h2 class="section-title-main">üë• ÿßŸÑŸÑÿßÿπÿ®ŸäŸÜ ÿßŸÑŸÜÿ¥ÿ∑ŸäŸÜ (0) - ${title} ${icon}</h2>
                    <button class="action-button gray" onclick="showSectionDashboard()" style="margin-bottom: 20px;">‚Üê ÿ±ÿ¨Ÿàÿπ</button>
                    <div class="empty-state">
                        <div class="empty-icon">üë•</div>
                        <div class="empty-text">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ¨ŸÑÿ≥ÿßÿ™ ŸÜÿ¥ÿ∑ÿ© ÿ≠ÿßŸÑŸäÿßŸã</div>
                    </div>
                `;
                return;
            }
            
            let playersHTML = players.map(player => createPlayerCard(player, mode, deviceLabel)).join('');
            
            sectionView.innerHTML = `
                <h2 class="section-title-main">üë• ÿßŸÑŸÑÿßÿπÿ®ŸäŸÜ ÿßŸÑŸÜÿ¥ÿ∑ŸäŸÜ (${players.length}) - ${title} ${icon}</h2>
                <button class="action-button gray" onclick="showSectionDashboard()" style="margin-bottom: 20px;">‚Üê ÿ±ÿ¨Ÿàÿπ</button>
                <div class="players-container">
                    ${playersHTML}
                </div>
            `;
            
            players.forEach(player => startCountdown(player));
        }

        function createPlayerCard(player, mode, deviceLabel) {
            const now = Date.now();
            const duration = Math.floor((now - player.startTime) / 1000);
            const hours = Math.floor(duration / 3600);
            const minutes = Math.floor((duration % 3600) / 60);
            const durationStr = `${hours}:${minutes.toString().padStart(2, '0')}`;
            
            const startTimeStr = new Date(player.startTime).toLocaleTimeString('ar-IQ', {
                hour: '2-digit',
                minute: '2-digit',
                hour12: true
            });
            
            const currentCost = calculateCost(player.startTime, now, player.customRate);
            
            let stripeColor = '#238636';
            const hoursActive = duration / 3600;
            if (hoursActive >= 3) stripeColor = '#da3633';
            else if (hoursActive >= 2) stripeColor = '#d4af37';
            
            const remainingMins = Math.floor(player.remaining / 60);
            const remainingSecs = player.remaining % 60;
            const countdownClass = player.remaining <= 0 ? 'countdown-expired' : '';
            
            return `
                <div class="player-card">
                    <div class="player-card-stripe" style="background: ${stripeColor}"></div>
                    <div class="player-card-content">
                        <div class="player-header">
                            <div class="player-info">
                                <h3>üë§ ${player.name}</h3>
                                <span class="player-table-badge">${deviceLabel} ${player.tableNumber}</span>
                                ${player.notes ? `<div class="player-notes">üìù ${player.notes}</div>` : ''}
                            </div>
                            <div class="player-actions">
                                <button class="btn-icon btn-edit" onclick="editPlayer(${player.id})" title="ÿ™ÿπÿØŸäŸÑ">‚úèÔ∏è</button>
                                <button class="btn-icon btn-end" onclick="endSession(${player.id})" title="ÿ•ŸÜŸáÿßÿ°">‚ùå</button>
                            </div>
                        </div>
                        <div class="player-stats">
                            <div class="countdown-box ${countdownClass}" id="countdown-${player.id}">
                                ‚è≥ ${remainingMins.toString().padStart(2, '0')}:${remainingSecs.toString().padStart(2, '0')}
                            </div>
                            <div class="player-stat-box">
                                <div class="player-stat-label">‚è∞ ÿßŸÑÿ®ÿØÿ°</div>
                                <div class="player-stat-value" style="color: #58a6ff">${startTimeStr}</div>
                            </div>
                            <div class="player-stat-box">
                                <div class="player-stat-label">‚è±Ô∏è ÿßŸÑŸÖÿØÿ©</div>
                                <div class="player-stat-value" style="color: #d4af37">${durationStr}</div>
                            </div>
                            <div class="player-stat-box">
                                <div class="player-stat-label">üíµ ÿßŸÑÿ≥ÿπÿ±</div>
                                <div class="player-stat-value" style="color: #8957e5">${player.customRate.toLocaleString()} ÿØ.ÿπ/ÿ≥</div>
                            </div>
                            <div class="player-stat-box">
                                <div class="player-stat-label">üí∞ ÿßŸÑÿ™ŸÉŸÑŸÅÿ©</div>
                                <div class="player-stat-value" style="color: #3fb950">${currentCost.toLocaleString()} ÿØ.ÿπ</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function calculateCost(startTime, endTime, rate, gamesCount = null) {
    if (gamesCount && gamesCount > 0) return rate * gamesCount;
    const hours = (endTime - startTime) / (1000 * 60 * 60);
    const cost = Math.round(hours * rate);
    return Math.max(cost, 0);
}

        function startCountdown(player) {
            if (countdownIntervals[player.id]) {
                clearInterval(countdownIntervals[player.id]);
            }
            
            countdownIntervals[player.id] = setInterval(() => {
                const elem = document.getElementById(`countdown-${player.id}`);
                if (!elem) {
                    clearInterval(countdownIntervals[player.id]);
                    return;
                }
                
                player.remaining = Math.max(0, player.remaining - 1);
                
                const mins = Math.floor(player.remaining / 60);
                const secs = player.remaining % 60;
                
                elem.textContent = `‚è≥ ${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                
                if (player.remaining === 0) {
                    elem.classList.add('countdown-expired');
                    
                    if (!player.timeFinishedAlerted) {
                        player.timeFinishedAlerted = true;
                        const deviceLabel = currentMode === 'billiard' ? 'ÿßŸÑÿ∑ÿßŸàŸÑÿ©' : 'ÿßŸÑÿ¨Ÿáÿßÿ≤';
                        alert(`‚è∞ ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑŸàŸÇÿ™\n\nÿßŸÜÿ™ŸáŸâ ŸàŸÇÿ™ ${player.name} ÿπŸÑŸâ ${deviceLabel} ${player.tableNumber}`);
                        addNotification(
                            '‚è∞ ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑÿ¨ŸÑÿ≥ÿ©',
                            `ÿßŸÜÿ™ŸáŸâ ŸàŸÇÿ™ ${player.name} ÿπŸÑŸâ ${deviceLabel} ${player.tableNumber}`,
                            'warning'
                        );
                        
                        // ‚úÖ ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿ¨ŸÑÿ≥ÿ© ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ÿ®ÿπÿØ 10 ÿ´ŸàÿßŸÜŸä
                        setTimeout(() => {
                            const stillExists = APP_DATA[currentMode].activePlayers.find(p => p.id === player.id);
                            if(stillExists && stillExists.remaining <= 0) {
                                console.log(`üõë ÿ•ŸÜŸáÿßÿ° ÿ™ŸÑŸÇÿßÿ¶Ÿä ŸÑŸÑÿßÿπÿ® ${player.name}`);
                                endSession(player.id);
                            }
                        }, 10000);
                    }
                    
                    clearInterval(countdownIntervals[player.id]);
                }
                
                saveData();
            }, 1000);
        }

        function endSession(playerId) {
            const mode = currentMode;
            const player = APP_DATA[mode].activePlayers.find(p => p.id === playerId);
            if (!player) return;
            
            const endTime = Date.now();
            const duration = Math.floor((endTime - player.startTime) / 1000);
            const hours = Math.floor(duration / 3600);
            const minutes = Math.floor((duration % 3600) / 60);
            const durationStr = `${hours}:${minutes.toString().padStart(2, '0')}`;
            
            const cost = calculateCost(player.startTime, endTime, player.customRate);
            
            const session = {
                id: endTime,
                name: player.name,
                tableNumber: player.tableNumber,
                startTime: player.startTime,
                endTime: endTime,
                duration: durationStr,
                cost: cost,
                rateUsed: player.customRate,
                notes: player.notes
            };
            
            APP_DATA[mode].completedSessions.push(session);
            APP_DATA[mode].activePlayers = APP_DATA[mode].activePlayers.filter(p => p.id !== playerId);
            
            if (countdownIntervals[playerId]) {
                clearInterval(countdownIntervals[playerId]);
                delete countdownIntervals[playerId];
            }
            
            saveData();
            
            const deviceLabel = mode === 'billiard' ? 'ÿßŸÑÿ∑ÿßŸàŸÑÿ©' : 'ÿßŸÑÿ¨Ÿáÿßÿ≤';
            addNotification('‚úî ÿ¨ŸÑÿ≥ÿ© ŸÖŸÜÿ™ŸáŸäÿ©', `${player.name} - ${cost.toLocaleString()} ÿØ.ÿπ`, 'success');
            
            alert(`‚úî ÿßŸÜÿ™Ÿáÿ™ ÿßŸÑÿ¨ŸÑÿ≥ÿ©\n\nÿßŸÑŸÑÿßÿπÿ®: ${player.name}\n${deviceLabel}: ${player.tableNumber}\nÿßŸÑŸÖÿØÿ©: ${durationStr}\nÿßŸÑÿ≥ÿπÿ±: ${player.customRate.toLocaleString()} ÿØ.ÿπ/ÿ≥ÿßÿπÿ©\nÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä: ${cost.toLocaleString()} ÿØ.ÿπ`);
            
            showActivePlayers();
        }

        function editPlayer(playerId) {
            const mode = currentMode;
            const player = APP_DATA[mode].activePlayers.find(p => p.id === playerId);
            if (!player) return;
            
            editingPlayerId = playerId;
            
            const deviceLabel = mode === 'billiard' ? 'üéØ ÿ±ŸÇŸÖ ÿßŸÑÿ∑ÿßŸàŸÑÿ©' : 'üéÆ ÿ±ŸÇŸÖ ÿßŸÑÿ¨Ÿáÿßÿ≤';
            document.getElementById('edit-table-label').textContent = deviceLabel;
            document.getElementById('edit-name').value = player.name;
            document.getElementById('edit-table').value = player.tableNumber;
            document.getElementById('edit-rate').value = player.customRate;
            document.getElementById('edit-current-rate').textContent = player.customRate.toLocaleString();
            document.getElementById('edit-notes').value = player.notes || '';
            document.getElementById('edit-remaining').value = player.remaining;
            
            document.getElementById('edit-modal').style.display = 'block';
        }

        function closeEditModal() {
            document.getElementById('edit-modal').style.display = 'none';
            editingPlayerId = null;
        }

        function handleEditPlayer(event) {
            event.preventDefault();
            
            if (!editingPlayerId) return;
            
            const mode = currentMode;
            const player = APP_DATA[mode].activePlayers.find(p => p.id === editingPlayerId);
            if (!player) return;
            
            const newName = document.getElementById('edit-name').value.trim();
            const newTable = document.getElementById('edit-table').value.trim();
            const newRate = parseInt(document.getElementById('edit-rate').value);
            const newNotes = document.getElementById('edit-notes').value.trim();
            const newRemaining = parseInt(document.getElementById('edit-remaining').value);
            
            if (!newName || !newTable || newRate <= 0) {
                alert('ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿµÿ≠Ÿäÿ≠ÿ©');
                return;
            }
            
            player.name = newName;
            player.tableNumber = newTable;
            player.customRate = newRate;
            player.notes = newNotes;
            player.remaining = Math.max(0, newRemaining);
            
            if (newRemaining > 0) {
                player.timeFinishedAlerted = false;
            }
            
            saveData();
            
            addNotification('‚úèÔ∏è ÿ™ÿπÿØŸäŸÑ', `ÿ™ŸÖ ÿ™ÿπÿØŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ${newName}`, 'info');
            
            closeEditModal();
            showActivePlayers();
        }

        function showHistory() {
            const mode = currentMode;
            const sessions = APP_DATA[mode].completedSessions;
            const icon = mode === 'billiard' ? 'üé±' : 'üéÆ';
            const title = mode === 'billiard' ? 'ÿ®ŸÑŸäÿßÿ±ÿØŸà' : 'ÿ®ŸÑÿßŸäÿ≥ÿ™Ÿäÿ¥ŸÜ';
            const deviceLabel = mode === 'billiard' ? 'ÿ∑ÿßŸàŸÑÿ©' : 'ÿ¨Ÿáÿßÿ≤';
            
            const totalRevenue = sessions.reduce((sum, s) => sum + s.cost, 0);
            const avgSession = sessions.length > 0 ? Math.floor(totalRevenue / sessions.length) : 0;
            
            const sectionView = document.getElementById('section-view');
            
            if (sessions.length === 0) {
                sectionView.innerHTML = `
                    <h2 class="section-title-main">üìã ÿ≥ÿ¨ŸÑ ÿßŸÑŸäŸàŸÖ ŸàÿßŸÑÿ£ÿ±ÿ®ÿßÿ≠ - ${title} ${icon}</h2>
                    <button class="action-button gray" onclick="showSectionDashboard()" style="margin-bottom: 20px;">‚Üê ÿ±ÿ¨Ÿàÿπ</button>
                    <div class="empty-state">
                        <div class="empty-icon">üìã</div>
                        <div class="empty-text">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ¨ŸÑÿ≥ÿßÿ™ ŸÖŸÉÿ™ŸÖŸÑÿ© ÿßŸÑŸäŸàŸÖ</div>
                    </div>
                `;
                return;
            }
            
            const sessionsHTML = sessions.slice().reverse().map(session => {
                const startTime = new Date(session.startTime).toLocaleTimeString('ar-IQ', {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: true
                });
                const endTime = new Date(session.endTime).toLocaleTimeString('ar-IQ', {
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: true
                });
                
                return `
                    <div class="player-card">
                        <div class="player-card-stripe" style="background: #8957e5"></div>
                        <div class="player-card-content">
                            <div class="player-header">
                                <div class="player-info">
                                    <h3>üë§ ${session.name}</h3>
                                    <span class="player-table-badge" style="background: #8957e5">${deviceLabel} ${session.tableNumber}</span>
                                    ${session.notes ? `<div class="player-notes">üìù ${session.notes}</div>` : ''}
                                </div>
                                <div style="font-size: 16px; font-weight: bold; color: #3fb950;">
                                    ${session.cost.toLocaleString()} ÿØ.ÿπ
                                </div>
                            </div>
                            <div style="font-size: 9px; color: #6e7681; margin-top: 10px; text-align: right;">
                                ŸÖŸÜ ${startTime} ÿ•ŸÑŸâ ${endTime} ‚Ä¢ ${session.duration} ‚Ä¢ ${session.rateUsed.toLocaleString()} ÿØ.ÿπ/ÿ≥
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            sectionView.innerHTML = `
                <h2 class="section-title-main">üìã ÿ≥ÿ¨ŸÑ ÿßŸÑŸäŸàŸÖ ŸàÿßŸÑÿ£ÿ±ÿ®ÿßÿ≠ - ${title} ${icon}</h2>
                <button class="action-button gray" onclick="showSectionDashboard()" style="margin-bottom: 20px;">‚Üê ÿ±ÿ¨Ÿàÿπ</button>
                
                <div class="stat-card" style="margin-bottom: 20px;">
                    <div class="stat-card-accent" style="background: #d4af37"></div>
                    <div class="stat-card-content">
                        <div style="font-size: 16px; font-weight: bold; color: #c9d1d9; margin-bottom: 10px;">üí∞ ÿ•ÿ¨ŸÖÿßŸÑŸä ÿ£ÿ±ÿ®ÿßÿ≠ ÿßŸÑŸäŸàŸÖ</div>
                        <div style="font-size: 36px; font-weight: bold; color: #d4af37; margin: 10px 0;">${totalRevenue.toLocaleString()} ÿØ.ÿπ</div>
                        <div style="font-size: 11px; color: #8b949e;">
                            üéØ ${sessions.length} ÿ¨ŸÑÿ≥ÿ© ‚Ä¢ üìä ŸÖÿ™Ÿàÿ≥ÿ∑: ${avgSession.toLocaleString()} ÿØ.ÿπ
                        </div>
                    </div>
                </div>
                
                <div class="players-container">
                    ${sessionsHTML}
                </div>
            `;
        }

        function openAdvancedSearch() {
            document.getElementById('search-input').value = '';
            document.getElementById('search-results').innerHTML = '';
            document.getElementById('search-modal').style.display = 'block';
        }

        function closeSearchModal() {
            document.getElementById('search-modal').style.display = 'none';
        }

        function handleSearch(event) {
            if (event.key === 'Enter') {
                performSearch();
            }
        }

        function performSearch() {
            const query = document.getElementById('search-input').value.trim().toLowerCase();
            const resultsContainer = document.getElementById('search-results');
            
            if (!query) {
                resultsContainer.innerHTML = '<div class="search-no-results">‚ö†Ô∏è ÿ£ÿØÿÆŸÑ ŸÉŸÑŸÖÿ© ÿßŸÑÿ®ÿ≠ÿ´</div>';
                return;
            }
            
            const allSessions = [];
            
            APP_DATA.billiard.completedSessions.forEach(s => {
                allSessions.push({ ...s, source: 'billiard' });
            });
            
            APP_DATA.ps.completedSessions.forEach(s => {
                allSessions.push({ ...s, source: 'ps' });
            });
            
            const results = allSessions.filter(session => {
                const nameMatch = session.name.toLowerCase().includes(query);
                const tableMatch = session.tableNumber.toString().toLowerCase().includes(query);
                return nameMatch || tableMatch;
            });
            
            if (results.length === 0) {
                resultsContainer.innerHTML = '<div class="search-no-results">‚ùå ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÜÿ™ÿßÿ¶ÿ¨ ŸÖÿ∑ÿßÿ®ŸÇÿ©</div>';
                return;
            }
            
            resultsContainer.innerHTML = `
                <div style="font-size: 13px; font-weight: bold; color: #3fb950; margin-bottom: 15px; text-align: center;">
                    ‚úî ÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ${results.length} ŸÜÿ™Ÿäÿ¨ÿ©
                </div>
                ${results.map(session => {
                    const icon = session.source === 'billiard' ? 'üé±' : 'üéÆ';
                    const deviceLabel = session.source === 'billiard' ? 'ÿ∑ÿßŸàŸÑÿ©' : 'ÿ¨Ÿáÿßÿ≤';
                    
                    const startTime = new Date(session.startTime).toLocaleTimeString('ar-IQ', {
                        hour: '2-digit',
                        minute: '2-digit',
                        hour12: true
                    });
                    
                    const endTime = new Date(session.endTime).toLocaleTimeString('ar-IQ', {
                        hour: '2-digit',
                        minute: '2-digit',
                        hour12: true
                    });
                    
                    return `
                        <div class="search-result-item">
                            <div class="search-result-header">
                                <div>
                                    <span class="search-result-name">${icon} ${session.name}</span>
                                    <div style="margin-top: 5px;">
                                        <span style="background: #8957e5; color: white; padding: 3px 8px; border-radius: 4px; font-size: 11px;">
                                            ${deviceLabel} ${session.tableNumber}
                                        </span>
                                    </div>
                                    ${session.notes ? `<div style="font-size: 10px; color: #8b949e; margin-top: 5px;">üìù ${session.notes}</div>` : ''}
                                </div>
                                <span class="search-result-cost">${session.cost.toLocaleString()} ÿØ.ÿπ</span>
                            </div>
                            <div class="search-result-details">
                                ŸÖŸÜ ${startTime} ÿ•ŸÑŸâ ${endTime} ‚Ä¢ ${session.duration} ‚Ä¢ ${session.rateUsed.toLocaleString()} ÿØ.ÿπ/ÿ≥
                            </div>
                        </div>
                    `;
                }).join('')}
            `;
        }

        window.addEventListener('click', (event) => {
            const registerModal = document.getElementById('register-modal');
            const notificationsModal = document.getElementById('notifications-modal');
            const searchModal = document.getElementById('search-modal');
            const editModal = document.getElementById('edit-modal');
            
            if (event.target === registerModal) {
                closeRegisterModal();
            }
            if (event.target === notificationsModal) {
                closeNotifications();
            }
            if (event.target === searchModal) {
                closeSearchModal();
            }
            if (event.target === editModal) {
                closeEditModal();
            }
        });

        window.addEventListener('load', () => {
            loadData();
            updateNotificationBadge();
        });

        // Settings Functions
        function getStorageKey() {
            const user = APP_DATA && APP_DATA.currentUser ? APP_DATA.currentUser.username : 'guest';
            return 'billiardSystemData_' + user;
        }

        function loadDataPerUser() {
            try {
                const raw = localStorage.getItem(getStorageKey());
                if (raw) {
                    const perUser = JSON.parse(raw);
                    if (perUser.billiard) APP_DATA.billiard = perUser.billiard;
                    if (perUser.ps) APP_DATA.ps = perUser.ps;
                    if (perUser.notifications) APP_DATA.notifications = perUser.notifications;
                }
            } catch(e) { console.error('loadDataPerUser', e); }
        }

        function saveDataPerUser() {
            try {
                const perUser = {
                    billiard: APP_DATA.billiard,
                    ps: APP_DATA.ps,
                    notifications: APP_DATA.notifications
                };
                localStorage.setItem(getStorageKey(), JSON.stringify(perUser));
            } catch(e) { console.error('saveDataPerUser', e); }
        }

        function openSettings() {
            refreshUsersList();
            document.getElementById('settings-modal').style.display = 'block';
            const theme = localStorage.getItem('ui_theme') || 'gold';
            const sound = localStorage.getItem('notif_sound') || 'on';
            const nm = APP_DATA && APP_DATA.currentUser ? APP_DATA.currentUser.name : 'ÿßŸÑŸÖÿØŸäÿ±';
            const nmEl = document.getElementById('set-display-name');
            if (nmEl) nmEl.value = nm;
            const tSel = document.getElementById('theme-select');
            if (tSel) tSel.value = theme;
            const sSel = document.getElementById('notif-sound');
            if (sSel) sSel.value = sound;
        }

        function closeSettings() {
            document.getElementById('settings-modal').style.display = 'none';
        }

        function showSettingsTab(id) {
            ['account', 'appearance', 'backup', 'users'].forEach(function(k) {
                const el = document.getElementById('tab-' + k);
                if (el) el.style.display = (k === id) ? 'block' : 'none';
            });
        }

        async function saveAccountSettings() {
            const newName = document.getElementById('set-display-name').value.trim();
            const newPass = document.getElementById('set-password').value.trim();
            if (newName) {
                APP_DATA.currentUser.name = newName;
                const el = document.getElementById('current-user-name');
                if (el) el.textContent = 'üë§ ' + newName;
            }
            if (newPass) {
                const h = await hashPassword(newPass);
                APP_DATA.users[APP_DATA.currentUser.username].password = h;
            }
            saveData();
            alert('ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ≠ÿ≥ÿßÿ® ‚úÖ');
            const p = document.getElementById('set-password');
            if (p) p.value = '';
        }

        function saveAppearance() {
            const theme = document.getElementById('theme-select').value;
            const sound = document.getElementById('notif-sound').value;
            localStorage.setItem('ui_theme', theme);
            localStorage.setItem('notif_sound', sound);
            alert('ÿ™ŸÖ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ‚úÖ');
        }

        function refreshUsersList() {
            const box = document.getElementById('users-list');
            if (!box) return;
            const names = Object.keys(APP_DATA.users || {});
            if (names.length === 0) {
                box.innerHTML = 'ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖÿ≥ÿ™ÿÆÿØŸÖŸàŸÜ.';
                return;
            }
            box.innerHTML = names.map(function(u) {
                return '<div>‚Ä¢ ' + u + ' ‚Äî ' + (APP_DATA.users[u].role || 'ŸÖÿ≥ÿ™ÿÆÿØŸÖ') + '</div>';
            }).join('');
        }

        async function createUserFromSettings() {
            const u = document.getElementById('new-username').value.trim();
            const p = document.getElementById('new-password').value.trim();
            const r = document.getElementById('new-role').value;
            if (!u || !p) {
                alert('ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ŸàŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ±');
                return;
            }
            if (APP_DATA.users[u]) {
                alert('ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÖŸàÿ¨ŸàÿØ ŸÖÿ≥ÿ®ŸÇÿßŸã');
                return;
            }
            const h = await hashPassword(p);
            APP_DATA.users[u] = { password: h, name: u, role: r };
            saveData();
            refreshUsersList();
            document.getElementById('new-username').value = '';
            document.getElementById('new-password').value = '';
            alert('ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ‚úÖ');
        }

        function exportUserData() {
            const data = localStorage.getItem(getStorageKey()) || '{}';
            const blob = new Blob([data], { type: 'application/json' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = (APP_DATA.currentUser ? APP_DATA.currentUser.username : 'user') + '_backup.json';
            a.click();
            URL.revokeObjectURL(a.href);
        }

        const importFileEl = document.getElementById('import-file');
        if (importFileEl) {
            importFileEl.addEventListener('change', function(e) {
                const f = e.target.files[0];
                if (!f) return;
                const rd = new FileReader();
                rd.onload = function() {
                    try {
                        const obj = JSON.parse(rd.result);
                        localStorage.setItem(getStorageKey(), JSON.stringify(obj));
                        loadDataPerUser();
                        alert('ÿ™ŸÖ ÿßŸÑÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ‚úÖ');
                    } catch(err) {
                        alert('ŸÖŸÑŸÅ ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠');
                    }
                };
                rd.readAsText(f);
            });
        }

        function openDaysLog() {
            document.getElementById('dayslog-modal').style.display = 'block';
            const inp = document.getElementById('days-date');
            const today = new Date().toISOString().slice(0, 10);
            if (inp) inp.value = today;
            renderDay(today);
        }

        function closeDaysLog() {
            document.getElementById('dayslog-modal').style.display = 'none';
        }

        const daysDateEl = document.getElementById('days-date');
        if (daysDateEl) {
            daysDateEl.addEventListener('change', function(e) {
                renderDay(e.target.value);
            });
        }

        function renderDay(iso) {
            const box = document.getElementById('days-result');
            if (!box) return;
            const all = [].concat(
                (APP_DATA.billiard && APP_DATA.billiard.completedSessions ? APP_DATA.billiard.completedSessions : []).map(function(s) {
                    s = Object.assign({}, s);
                    s.source = 'billiard';
                    return s;
                }),
                (APP_DATA.ps && APP_DATA.ps.completedSessions ? APP_DATA.ps.completedSessions : []).map(function(s) {
                    s = Object.assign({}, s);
                    s.source = 'ps';
                    return s;
                })
            );
            const daySessions = all.filter(function(s) {
                const d = new Date(s.endTime || s.startTime);
                const ds = d.toISOString().slice(0, 10);
                return ds === iso;
            });
            if (daySessions.length === 0) {
                box.innerHTML = '<div class="empty-state"><div class="empty-icon">üìã</div><div class="empty-text">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ¨ŸÑÿ≥ÿßÿ™ ŸÅŸä Ÿáÿ∞ÿß ÿßŸÑŸäŸàŸÖ</div></div>';
                return;
            }
            const total = daySessions.reduce(function(t, s) {
                return t + (s.cost || 0);
            }, 0);
            const parts = [];
            parts.push(
                '<div class="stat-card" style="margin-bottom:14px"><div class="stat-card-accent" style="background: #d4af37"></div><div class="stat-card-content"><div style="font-weight:bold;color:#c9d1d9">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿ£ÿ±ÿ®ÿßÿ≠ ÿßŸÑŸäŸàŸÖ</div><div style="font-size:32px;color:#d4af37">' + total.toLocaleString() + ' ÿØ.ÿπ</div><div style="font-size:12px;color:#8b949e">ÿπÿØÿØ ÿßŸÑÿ¨ŸÑÿ≥ÿßÿ™: ' + daySessions.length + '</div></div></div>'
            );
            parts.push('<div class="players-container">');
            daySessions.slice().reverse().forEach(function(s) {
                const device = s.source === 'billiard' ? 'üé± ÿ∑ÿßŸàŸÑÿ©' : 'üéÆ ÿ¨Ÿáÿßÿ≤';
                parts.push(
                    '<div class="player-card"><div class="player-card-stripe" style="background:#8957e5"></div><div class="player-card-content"><div class="player-header"><div class="player-info"><h3>üë§ ' + s.name + '</h3><span class="player-table-badge">' + device + ' ' + s.tableNumber + '</span></div><div style="font-weight:bold;color:#3fb950">' + (s.cost || 0).toLocaleString() + ' ÿØ.ÿπ</div></div><div style="font-size:11px;color:#8b949e">ÿßŸÑŸÖÿØÿ©: ' + (s.duration || '--') + ' ‚Ä¢ ÿßŸÑÿ≥ÿπÿ±: ' + (s.rateUsed || 0).toLocaleString() + ' ÿØ.ÿπ/ÿ≥</div></div></div>'
                );
            });
            parts.push('</div>');
            box.innerHTML = parts.join('');
        }

        function openAnalytics() {
            document.getElementById('analytics-modal').style.display = 'block';
            const b = (APP_DATA.billiard && APP_DATA.billiard.completedSessions) ? APP_DATA.billiard.completedSessions : [];
            const p = (APP_DATA.ps && APP_DATA.ps.completedSessions) ? APP_DATA.ps.completedSessions : [];
            const revenueB = b.reduce(function(t, s) {
                return t + (s.cost || 0);
            }, 0);
            const revenueP = p.reduce(function(t, s) {
                return t + (s.cost || 0);
            }, 0);
            const total = revenueB + revenueP;
            const avgB = b.length ? Math.floor(revenueB / b.length) : 0;
            const avgP = p.length ? Math.floor(revenueP / p.length) : 0;

            function calcTopDevice(arr) {
                const map = {};
                arr.forEach(function(s) {
                    const k = (s.source === 'billiard' ? 'ÿ∑ÿßŸàŸÑÿ© ' : 'ÿ¨Ÿáÿßÿ≤ ') + s.tableNumber;
                    map[k] = (map[k] || 0) + 1;
                });
                let best = '‚Äî', cnt = 0;
                Object.keys(map).forEach(function(k) {
                    if (map[k] > cnt) {
                        cnt = map[k];
                        best = k;
                    }
                });
                return best + ' (' + cnt + ')';
            }

            const top = calcTopDevice(
                b.map(function(x) {
                    x = Object.assign({}, x);
                    x.source = 'billiard';
                    return x;
                }).concat(p.map(function(x) {
                    x = Object.assign({}, x);
                    x.source = 'ps';
                    return x;
                }))
            );

            function card(title, value) {
                return '<div class="stat-card"><div class="stat-card-accent" style="background: #d4af37"></div><div class="stat-card-content"><div style="font-size:14px;color:#c9d1d9">' + title + '</div><div style="font-size:28px;color:#d4af37;font-weight:bold">' + (typeof value === 'number' ? value.toLocaleString() : value) + '</div></div></div>';
            }

            const html = card('üí∞ ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ•Ÿäÿ±ÿßÿØ', total) +
                card('üé± ÿ•Ÿäÿ±ÿßÿØ ÿßŸÑÿ®ŸÑŸäÿßÿ±ÿØŸà', revenueB) +
                card('üéÆ ÿ•Ÿäÿ±ÿßÿØ ÿßŸÑÿ®ŸÑÿßŸäÿ≥ÿ™Ÿäÿ¥ŸÜ', revenueP) +
                card('‚ö° ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑÿ¨ŸÑÿ≥ÿ© (ÿ®ŸÑŸäÿßÿ±ÿØŸà)', avgB) +
                card('‚ö° ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑÿ¨ŸÑÿ≥ÿ© (ÿ®ŸÑÿßŸäÿ≥ÿ™Ÿäÿ¥ŸÜ)', avgP) +
                card('‚≠ê ÿ£ŸÉÿ´ÿ± ÿ∑ÿßŸàŸÑÿ©/ÿ¨Ÿáÿßÿ≤ ŸÜÿ¥ÿßÿ∑ÿßŸã', top);
            const cont = document.getElementById('analytics-cards');
            if (cont) cont.innerHTML = html;
        }

        function closeAnalytics() {
            document.getElementById('analytics-modal').style.display = 'none';
        }

        // ‚úÖ Ÿàÿ∏ŸäŸÅÿ© ÿ£ÿ±ÿ¥ŸÅÿ© ÿßŸÑŸÑÿßÿπÿ®ŸäŸÜ
        function archivePlayers() {
            const mode = currentMode;
            if (!mode) {
                alert('ÿßŸÑÿ±ÿ¨ÿßÿ° ÿßÿÆÿ™Ÿäÿßÿ± ŸÇÿ≥ŸÖ ÿ£ŸàŸÑÿßŸã (ÿ®ŸÑŸäÿßÿ±ÿØŸà ÿ£Ÿà ÿ®ŸÑÿßŸäÿ≥ÿ™Ÿäÿ¥ŸÜ)');
                return;
            }

            const sessions = APP_DATA[mode].completedSessions;
            if (sessions.length === 0) {
                alert('ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ¨ŸÑÿ≥ÿßÿ™ ŸÑÿ£ÿ±ÿ¥ŸÅÿ™Ÿáÿß!');
                return;
            }

            if (!confirm(`ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ£ÿ±ÿ¥ŸÅÿ© ÿ¨ŸÖŸäÿπ ÿßŸÑÿ¨ŸÑÿ≥ÿßÿ™ ÿßŸÑŸÖŸÉÿ™ŸÖŸÑÿ© (${sessions.length} ÿ¨ŸÑÿ≥ÿ©)ÿü\n\nÿ≥Ÿäÿ™ŸÖ ÿ≠ŸÅÿ∏Ÿáÿß ŸÅŸä ŸÖŸÑŸÅ ŸàŸÜŸÇŸÑŸáÿß ŸÖŸÜ ÿßŸÑÿ≥ÿ¨ŸÑ ÿßŸÑÿ≠ÿßŸÑŸä.`)) {
                return;
            }

            // ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅ ÿßŸÑÿ£ÿ±ÿ¥ŸäŸÅ
            const archiveData = {
                mode: mode,
                archiveDate: new Date().toISOString(),
                totalSessions: sessions.length,
                totalRevenue: sessions.reduce((sum, s) => sum + s.cost, 0),
                sessions: sessions
            };

            // ÿ™ŸÜÿ≤ŸäŸÑ ÿßŸÑŸÖŸÑŸÅ
            const blob = new Blob([JSON.stringify(archiveData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const timestamp = new Date().toISOString().split('T')[0];
            a.download = `archive_${mode}_${timestamp}.json`;
            a.click();
            URL.revokeObjectURL(url);

            // ŸÖÿ≥ÿ≠ ÿßŸÑÿ≥ÿ¨ŸÑ ÿßŸÑŸÖÿ§ÿ±ÿ¥ŸÅ
            APP_DATA[mode].completedSessions = [];
            saveData();

            addNotification(
                'üì¶ ÿ™ŸÖÿ™ ÿßŸÑÿ£ÿ±ÿ¥ŸÅÿ©',
                `ÿ™ŸÖ ÿ£ÿ±ÿ¥ŸÅÿ© ${sessions.length} ÿ¨ŸÑÿ≥ÿ© ÿ®ŸÜÿ¨ÿßÿ≠`,
                'success'
            );

            alert(`‚úÖ ÿ™ŸÖÿ™ ÿßŸÑÿ£ÿ±ÿ¥ŸÅÿ© ÿ®ŸÜÿ¨ÿßÿ≠!\n\nÿ™ŸÖ ÿ≠ŸÅÿ∏ ${sessions.length} ÿ¨ŸÑÿ≥ÿ© ŸÅŸä ÿßŸÑŸÖŸÑŸÅ\nÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä: ${archiveData.totalRevenue.toLocaleString()} ÿØ.ÿπ`);

            showSectionDashboard();
        }

        // ‚úÖ Ÿàÿ∏ŸäŸÅÿ© ÿ±Ÿäÿ≥ÿ™ ÿßŸÑŸÑÿßÿπÿ®ŸäŸÜ
        function resetPlayers() {
            const mode = currentMode;
            if (!mode) {
                alert('ÿßŸÑÿ±ÿ¨ÿßÿ° ÿßÿÆÿ™Ÿäÿßÿ± ŸÇÿ≥ŸÖ ÿ£ŸàŸÑÿßŸã (ÿ®ŸÑŸäÿßÿ±ÿØŸà ÿ£Ÿà ÿ®ŸÑÿßŸäÿ≥ÿ™Ÿäÿ¥ŸÜ)');
                return;
            }

            const activeCount = APP_DATA[mode].activePlayers.length;
            const completedCount = APP_DATA[mode].completedSessions.length;
            const totalCount = activeCount + completedCount;

            if (totalCount === 0) {
                alert('ŸÑÿß ŸäŸàÿ¨ÿØ ÿ¥Ÿäÿ° ŸÑÿ≠ÿ∞ŸÅŸá!');
                return;
            }

            const confirmMsg = `‚ö†Ô∏è ÿ™ÿ≠ÿ∞Ÿäÿ±: ÿπŸÖŸÑŸäÿ© ÿÆÿ∑Ÿäÿ±ÿ©!\n\n` +
                `ÿ≥Ÿäÿ™ŸÖ ÿ≠ÿ∞ŸÅ:\n` +
                `‚Ä¢ ${activeCount} ŸÑÿßÿπÿ® ŸÜÿ¥ÿ∑\n` +
                `‚Ä¢ ${completedCount} ÿ¨ŸÑÿ≥ÿ© ŸÖŸÉÿ™ŸÖŸÑÿ©\n\n` +
                `ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ 100%ÿü`;

            if (!confirm(confirmMsg)) {
                return;
            }

            // ÿ™ÿ£ŸÉŸäÿØ ÿ´ÿßŸÜŸä
            if (!confirm('‚ö†Ô∏è ÿßŸÑÿ™ÿ£ŸÉŸäÿØ ÿßŸÑŸÜŸáÿßÿ¶Ÿä!\n\nŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑÿ™ÿ±ÿßÿ¨ÿπ ÿπŸÜ Ÿáÿ∞Ÿá ÿßŸÑÿπŸÖŸÑŸäÿ©!\n\nÿßÿ∂ÿ∫ÿ∑ OK ŸÑŸÑÿ≠ÿ∞ŸÅ ÿßŸÑŸÜŸáÿßÿ¶Ÿä')) {
                return;
            }

            // ÿ•ŸäŸÇÿßŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑÿπÿØÿßÿØÿßÿ™
            Object.keys(countdownIntervals).forEach(key => {
                clearInterval(countdownIntervals[key]);
                delete countdownIntervals[key];
            });

            // ÿ≠ÿ∞ŸÅ ŸÉŸÑ ÿ¥Ÿäÿ°
            APP_DATA[mode].activePlayers = [];
            APP_DATA[mode].completedSessions = [];
            saveData();

            addNotification(
                'üîÑ ÿ™ŸÖ ÿßŸÑÿ±Ÿäÿ≥ÿ™',
                `ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ ŸÇÿ≥ŸÖ ${mode === 'billiard' ? 'ÿßŸÑÿ®ŸÑŸäÿßÿ±ÿØŸà' : 'ÿßŸÑÿ®ŸÑÿßŸäÿ≥ÿ™Ÿäÿ¥ŸÜ'}`,
                'warning'
            );

            alert(`‚úÖ ÿ™ŸÖ ÿßŸÑÿ±Ÿäÿ≥ÿ™ ÿ®ŸÜÿ¨ÿßÿ≠!\n\nÿ™ŸÖ ÿ≠ÿ∞ŸÅ ${totalCount} ÿ≥ÿ¨ŸÑ`);

            showSectionDashboard();
        }

        // ÿ•ÿµŸÑÿßÿ≠: ÿ™ÿπÿ±ŸäŸÅ window.APP_DATA
        if (typeof APP_DATA !== 'undefined') window.APP_DATA = APP_DATA;
        
        // Google Sign-In Functions
        function parseJwt(token){
            const b64=token.split('.')[1]; 
            if(!b64) return {};
            const json=decodeURIComponent(atob(b64).split('').map(c=>'%'+('00'+c.charCodeAt(0).toString(16)).slice(-2)).join(''));
            return JSON.parse(json);
        }
        
        async function handleCredentialResponse(resp){
            if(!resp || !resp.credential){ 
                alert('ŸÅÿ¥ŸÑ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿπÿ®ÿ± Google'); 
                return; 
            }
            const p=parseJwt(resp.credential);
            try{ 
                localStorage.setItem('google_user_payload', JSON.stringify(p)); 
            }catch(e){}
            showGoogleUser(p);
            
            // ‚úÖ ÿ•ÿµŸÑÿßÿ≠: ÿßŸÑÿØÿÆŸàŸÑ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä ÿ®ÿπÿØ ÿ™ÿ≥ÿ¨ŸäŸÑ Google
            const email = p.email || '';
            const username = email.split('@')[0] || 'google_user';
            
            // ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ® ÿ™ŸÑŸÇÿßÿ¶Ÿä ÿ•ÿ∞ÿß ŸÑŸÖ ŸäŸÉŸÜ ŸÖŸàÿ¨ŸàÿØ
            if(!APP_DATA.users[username]){
                const randomPass = 'google_' + Date.now();
                const hashedPass = await hashPassword(randomPass);
                APP_DATA.users[username] = {
                    password: hashedPass,
                    name: p.name || username,
                    role: 'ŸÖÿØŸäÿ±'
                };
                saveData();
            }
            
            // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ŸÖÿ®ÿßÿ¥ÿ±ÿ©
            APP_DATA.currentUser = {
                username: username,
                name: APP_DATA.users[username].name,
                role: APP_DATA.users[username].role
            };
            
            document.getElementById('current-user-name').textContent = 'üë§ ' + APP_DATA.currentUser.name;
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('main-interface').style.display = 'block';
            
            startClock();
            updateNotificationBadge();
            addNotification('‚úÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ Google', `${APP_DATA.currentUser.name} ÿØÿÆŸÑ ÿπÿ®ÿ± Google`, 'success');
        }
        
        function showGoogleUser(p){
            const bar=document.getElementById('googleUserBar');
            if(!bar) return;
            document.getElementById('gUserPic').src=p.picture||'';
            document.getElementById('gUserName').textContent=p.name||p.email||'ŸÖÿ≥ÿ™ÿÆÿØŸÖ';
            document.getElementById('gUserEmail').textContent=p.email||'';
            bar.style.display='flex';
        }
        
        function googleLogout(){
            try{
                const saved=JSON.parse(localStorage.getItem('google_user_payload')||'{}');
                if(window.google?.accounts?.id){
                    google.accounts.id.disableAutoSelect();
                    if(saved.email){ 
                        google.accounts.id.revoke(saved.email, ()=>{}); 
                    }
                }
            }catch(e){}
            localStorage.removeItem('google_user_payload');
            const bar=document.getElementById('googleUserBar');
            if(bar) bar.style.display='none';
            
            // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ ŸÖŸÜ ÿßŸÑŸÜÿ∏ÿßŸÖ ÿ£Ÿäÿ∂ÿßŸã
            if(typeof handleLogout === 'function') {
                handleLogout();
            }
        }
        
        window.addEventListener('load', ()=>{
            try{
                const saved=localStorage.getItem('google_user_payload');
                if(saved){ 
                    showGoogleUser(JSON.parse(saved)); 
                }
            }catch(e){}
        });
    </script>

    <!-- Firebase Realtime Listener Script -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
        import { getDatabase, ref, onChildAdded, get } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC9Y_FW-ULjOD5F7U-WBV7aBMNvEyKAhfg",
            authDomain: "billiard-system.firebaseapp.com",
            databaseURL: "https://billiard-system-default-rtdb.firebaseio.com/",
            projectId: "billiard-system",
            storageBucket: "billiard-system.appspot.com",
            messagingSenderId: "152994650455",
            appId: "1:152994650455:web:1a68b2cd713b11a9cc612"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // ÿ≠ŸÅÿ∏ ÿßŸÑŸÖŸÅÿßÿ™Ÿäÿ≠ ÿßŸÑŸÖÿπÿßŸÑÿ¨ÿ©
        const PROCESSED_KEY = 'firebase_processed_all_tables_v1';
        function getProcessed() {
            try {
                return new Set(JSON.parse(localStorage.getItem(PROCESSED_KEY) || '[]'));
            } catch {
                return new Set();
            }
        }

        function addProcessed(key) {
            const set = getProcessed();
            set.add(key);
            const arr = Array.from(set).slice(-1000);
            localStorage.setItem(PROCESSED_KEY, JSON.stringify(arr));
        }

        // ÿßŸÑÿ•ÿ¥ÿπÿßÿ± ÿßŸÑÿ£ÿ≠ŸÖÿ±
        function showRedToast(title, body) {
            const t = document.createElement('div');
            t.className = 'firebase-toast-red';
            t.innerHTML = `
                <div class="toast-title">${title}</div>
                <div class="toast-body">${body}</div>
            `;
            document.body.appendChild(t);
            requestAnimationFrame(() => t.classList.add('show'));
            setTimeout(() => {
                t.classList.remove('show');
                setTimeout(() => t.remove(), 400);
            }, 6000);
        }

        // ÿµŸàÿ™ ÿßŸÑÿ™ŸÜÿ®ŸäŸá
        function playBeep() {
            try {
                const AudioCtx = window.AudioContext || window.webkitAudioContext;
                const ctx = new AudioCtx();
                const now = ctx.currentTime;

                function tone(freq, start, dur, vol = 0.3) {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.type = "square";
                    osc.frequency.value = freq;
                    gain.gain.setValueAtTime(0, now + start);
                    gain.gain.linearRampToValueAtTime(vol, now + start + 0.01);
                    gain.gain.exponentialRampToValueAtTime(0.001, now + start + dur);
                    osc.connect(gain).connect(ctx.destination);
                    osc.start(now + start);
                    osc.stop(now + start + dur + 0.05);
                }

                tone(880, 0, 0.2, 0.4);
                tone(1100, 0.25, 0.25, 0.35);
            } catch (e) {
                console.warn('Beep failed:', e);
            }
        }

        // ÿßŸÑŸÜÿ∑ŸÇ ÿßŸÑÿπÿ±ÿ®Ÿä
        function speak(text) {
            if (!('speechSynthesis' in window)) return;
            try {
                const u = new SpeechSynthesisUtterance(text);
                const voices = speechSynthesis.getVoices();
                const ar = voices.find(v => /^ar/i.test(v.lang));
                if (ar) u.voice = ar;
                u.lang = ar?.lang || 'ar-IQ';
                u.rate = 1.0;
                u.pitch = 1.0;
                speechSynthesis.cancel();
                speechSynthesis.speak(u);
            } catch (e) {
                console.warn('TTS failed:', e);
            }
        }

        // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÑÿßÿπÿ® ŸÑŸÑŸÜÿ∏ÿßŸÖ + ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä
        function addPlayerToSystem(payload, tableId) {
    const gameType = (payload.gameType || '').toLowerCase();
    const mode = gameType.includes('ps') || gameType.includes('play') ? 'ps' : 'billiard';
    const name = payload.playerName || payload.name || 'ŸÑÿßÿπÿ®';
    const table = tableId || payload.tableId || '1';
    const count = Number(payload.count || payload.gamesCount || 1);
    const minutes = Number(payload.minutes || (count * 10));
    const totalAmount = Number(payload.total || 0);
    const pricePerGame = count > 0 ? Math.round(totalAmount / count) : 1500;

    const player = {
        id: Date.now(),
        name: name,
        tableNumber: table,
        startTime: Date.now(),
        customRate: pricePerGame,
        notes: `ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ™ŸÑŸÇÿßÿ¶Ÿä ‚Ä¢ ${payload.mode === 'double' ? 'ÿ≤Ÿàÿ¨Ÿä' : 'ŸÖŸÅÿ±ÿØ'} ‚Ä¢ ${count} ŸÉŸäŸÖ √ó ${pricePerGame.toLocaleString()} ÿØ.ÿπ`,
        remaining: Math.max(0, minutes) * 60,
        initialMinutes: Math.max(1, minutes),
        gamesCount: count,
        overtimeAlerted: false,
        timeFinishedAlerted: false
    };

    if (!window.APP_DATA[mode]) {
        window.APP_DATA[mode] = {
            activePlayers: [],
            completedSessions: [],
            hourlyRate: mode === 'ps' ? 7000 : 5000
        };
    }
    if (!window.APP_DATA[mode].activePlayers)
        window.APP_DATA[mode].activePlayers = [];

    window.APP_DATA[mode].activePlayers.push(player);

    if (typeof window.saveData === 'function') window.saveData();

    const deviceLabel = mode === 'ps' ? 'ÿßŸÑÿ¨Ÿáÿßÿ≤' : 'ÿßŸÑÿ∑ÿßŸàŸÑÿ©';

    if (typeof window.addNotification === 'function') {
        window.addNotification(
            '‚úÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ™ŸÑŸÇÿßÿ¶Ÿä ŸÜÿßÿ¨ÿ≠',
            `${name} ÿπŸÑŸâ ${deviceLabel} ${table} (${count} ŸÉŸäŸÖ - ${totalAmount.toLocaleString()} ÿØ.ÿπ)`,
            'success'
        );
    }

    setTimeout(() => {
        if (typeof window.startCountdown === 'function')
            window.startCountdown(player);

        if (typeof window.currentMode !== 'undefined' &&
            typeof window.showActivePlayers === 'function') {

            if (window.currentMode === mode) {
                const sectionView = document.getElementById('section-view');

                if (sectionView && !sectionView.classList.contains('hidden'))
                    window.showActivePlayers();
            }
        }
    }, 200);
}

        const allTables = ['b1', 'b2', 'b3', 'b4', 'b5', 'b6', 'ps1', 'ps2', 'ps3', 'ps4'];

        async function attachTableListener(tableId) {
            const tableRegsRef = ref(db, `registrations/${tableId}`);

            try {
                const snap = await get(tableRegsRef);
                if (snap.exists()) {
                    snap.forEach(child => addProcessed(`${tableId}_${child.key}`));
                }

                onChildAdded(tableRegsRef, (childSnap) => {
                    const key = childSnap.key;
                    const fullKey = `${tableId}_${key}`;

                    if (getProcessed().has(fullKey)) {
                        console.log(`‚è≠Ô∏è ÿ™ŸÖ ŸÖÿπÿßŸÑÿ¨ÿ© Ÿáÿ∞ÿß ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ ŸÖÿ≥ÿ®ŸÇÿßŸã: ${fullKey}`);
                        return;
                    }
                    addProcessed(fullKey);

                    const data = childSnap.val() || {};
                    const name = data.playerName || data.name || 'ŸÑÿßÿπÿ®';
                    const gameType = data.gameType === 'ps' ? 'ÿ®ŸÑÿßŸäÿ≥ÿ™Ÿäÿ¥ŸÜ' : 'ÿ®ŸÑŸäÿßÿ±ÿØŸà';
                    const mode = data.mode === 'double' ? 'ÿ≤Ÿàÿ¨Ÿä' : 'ŸÖŸÅÿ±ÿØ';
                    const count = data.count || 1;
                    const minutes = data.minutes || (count * 10);

                    console.log('üîî ÿ™ÿ≥ÿ¨ŸäŸÑ ÿ¨ÿØŸäÿØ ŸÖŸÜ Firebase:', {
                        name,
                        tableId,
                        gameType,
                        mode,
                        count,
                        minutes
                    });

                    showRedToast(
                        'üîî ÿ™ÿ≥ÿ¨ŸäŸÑ ŸÑÿßÿπÿ® ÿ¨ÿØŸäÿØ',
                        `${name} ‚Ä¢ ${tableId.toUpperCase()} ‚Ä¢ ${gameType} ${mode} ‚Ä¢ ${count} ŸÉŸäŸÖ (${minutes} ÿØ)`
                    );

                    playBeep();
                    speak(`ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ŸÑÿßÿπÿ® ÿ¨ÿØŸäÿØ ${name} ÿπŸÑŸâ ${tableId} ŸÑÿπÿ®ÿ© ${gameType} ${mode}`);
                    addPlayerToSystem(data, tableId);
                });

                console.log(`‚úÖ ŸÖÿ≥ÿ™ŸÖÿπ Firebase ŸÖŸÅÿπŸëŸÑ ÿπŸÑŸâ: ${tableId}`);
            } catch (e) {
                console.error(`‚ùå ŸÅÿ¥ŸÑ ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÖÿ≥ÿ™ŸÖÿπ ÿπŸÑŸâ ${tableId}:`, e);
            }
        }

        allTables.forEach(tableId => attachTableListener(tableId));
        console.log('‚úÖ ŸÜÿ∏ÿßŸÖ ÿßŸÑÿßÿ≥ÿ™ŸÖÿßÿπ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä ŸÖŸÅÿπŸëŸÑ ÿπŸÑŸâ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ∑ÿßŸàŸÑÿßÿ™');
    </script>

<!-- ‚úÖ ÿ•ÿ∂ÿßŸÅÿ© ÿØŸàÿßŸÑ Google Sign-In ÿßŸÑŸÉÿßŸÖŸÑÿ© -->
<script>
function parseJwt(token) {
  try {
    const base64Url = token.split('.')[1];
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
      return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
    }).join(''));
    return JSON.parse(jsonPayload);
  } catch (e) {
    console.error('JWT parse error:', e);
    return {};
  }
}

function handleCredentialResponse(response) {
  const data = parseJwt(response.credential);
  const name = data.name || data.given_name || "ŸÖÿ≥ÿ™ÿÆÿØŸÖ Google";
  const email = data.email || "";
  const picture = data.picture || "https://ui-avatars.com/api/?background=0D8ABC&color=fff&name=" + encodeURIComponent(name);

  document.getElementById("current-user-name").textContent = "üë§ " + name;
  const userPic = document.getElementById("gUserPic");
  if (userPic) userPic.src = picture;

  document.getElementById("login-screen").style.display = "none";
  document.getElementById("main-interface").style.display = "block";

  localStorage.setItem("gsiUser", JSON.stringify({ name, email, picture }));

  if (typeof addNotification === "function") {
    addNotification("‚úÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ Google", name + " ‚Ä¢ " + email, "success");
  }
}

function restoreGoogleSession() {
  const raw = localStorage.getItem("gsiUser");
  if (!raw) return;
  const { name, email, picture } = JSON.parse(raw);

  document.getElementById("current-user-name").textContent = "üë§ " + name;
  const userPic = document.getElementById("gUserPic");
  if (userPic) userPic.src = picture;

  document.getElementById("login-screen").style.display = "none";
  document.getElementById("main-interface").style.display = "block";

  if (typeof addNotification === "function") {
    addNotification("ÿßÿ≥ÿ™ÿπÿßÿØÿ© ÿ¨ŸÑÿ≥ÿ© Google", name + " ‚Ä¢ " + email, "info");
  }
}

function googleLogout() {
  localStorage.removeItem("gsiUser");
  if (window.google && google.accounts && google.accounts.id) {
    google.accounts.id.disableAutoSelect();
  }
  document.getElementById("main-interface").style.display = "none";
  document.getElementById("login-screen").style.display = "block";
  if (typeof addNotification === "function") {
    addNotification("üö™ ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ ŸÖŸÜ Google", "", "warning");
  }
}

window.addEventListener("load", restoreGoogleSession);
</script>

</body>
</html>